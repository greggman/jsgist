{"version":3,"sources":["scrollbars.js","components/BackupManager.js","components/EditLine.js","components/Code.js","ServiceContext.js","libs/url.js","libs/WindowMessageManager.ts","components/GistComment.js","components/GistComments.js","components/Footer.js","libs/SubscriptionManager.ts","globals.js","libs/StorageManager.ts","libs/GitHub.js","components/Head.js","components/Dialog.js","components/Help.js","libs/model.js","libs/css-utils.js","components/CodeArea.js","libs/ui-model.js","components/File.js","components/Files.js","components/Log.js","components/Runner.js","components/Layout3Vertical.js","components/Layout3Horizontal.js","libs/utils.ts","components/Layout2x2.js","components/LayoutTabbed.js","components/IDE.js","libs/gists.js","components/LoadGist.tsx","components/LoadJSON.js","components/LoadURL.js","components/Section.js","components/Load.js","libs/compression.js","libs/loader.js","libs/OAuthManager.ts","components/Embed.js","components/Export.js","components/SaveAsGist.js","components/SaveAsJSON.js","components/SaveAsURL.js","components/Save.js","components/Settings.js","libs/UserManager.js","components/App.js","serviceWorker.js","index.js","icons/vertical-layout.svg","icons/horizontal-layout.svg","icons/two-by-two-layout.svg","icons/tabbed-layout.svg"],"names":["parent","document","createElement","setAttribute","classList","add","child","appendChild","body","firstChild","clientWidth","removeChild","BackupManager","storageManager","this","get","data","set","delete","EditLine","props","type","onChange","e","target","value","placeholder","darkMatcher","window","matchMedia","noop","Code","registerEditor","editor","hackKey","state","registerAPI","goToLine","lineNo","colNo","focus","doc","setCursor","refresh","_","options","onValueChange","isDarkMode","matches","codeMirrorOptions","mode","scrollbarStyle","theme","matchBrackets","lineNumbers","indexOf","matchTags","onBeforeChange","setState","editorDidMount","React","Component","ServiceContext","createContext","createURL","base","params","url","URL","searchParams","URLSearchParams","search","Object","entries","key","undefined","toString","href","nullHandlers","Map","fromToHandlersMap","on","from","fn","remove","handlers","fns","push","ndx","splice","length","size","callHandler","addEventListener","source","helperUrl","location","origin","Preview","handleSendPreview","iframeRef","current","contentWindow","postMessage","handleResize","style","height","createRef","show","winMsgMgr","preview","title","ref","src","GistComment","onUserStatusChange","forceUpdate","handleOnChange","tab","handleSaveComment","a","context","github","addError","gistId","addComment","createGistComment","previewKey","message","userManager","subscribe","unsubscribe","userData","getUserData","showPreview","className","login","rel","avatar_url","alt","name","id","checked","htmlFor","display","onClick","renderCommentForm","renderLogin","contextType","GistComments","nextProps","disqusId","gist_id","gitUserId","Footer","api","Fragment","SubscriptionManager","itemToSubscriptionMap","item","slice","prefix","subscriptionManager","_handleNewValue","startsWith","unPrefixedKey","substr","notify","session","k","_addPrefix","v","sessionStorage","getItem","localStorage","setItem","removeItem","removeEventListener","emptyValue","getEmptyFileHack","file","content","getGistContent","gist","JSON","parse","files","filenames","map","filter","concat","createGistData","secret","reduce","trim","saveData","jsGistData","keys","stringify","lowerCaseFiles","n","toLowerCase","includes","filename","description","public","GitHub","pat","user","unAuthorizedOctokit","Octokit","userAgent","owner","avatarURL","assign","event","Event","dispatchEvent","authorizedOctokit","auth","users","getAuthenticated","response","status","Error","paginate","gists","list","per_page","octokit","rawData","gistData","create","_updateUserData","updateGist","update","date","updated_at","fork","result","createComment","EventTarget","Head","Dialog","handleKeyDown","keyCode","onClose","children","tabIndex","stopPropagation","Help","validator","Ajv","compile","schema","trackedValues","getValueOrMakeNew","trackedValue","subscriptions","Set","initialValue","newValue","newTestData","getBlankData","getData","incVersion","incDataVersion","incFilesVersion","setFileName","newName","setFileContent","setData","newData","errors","dataPath","validate","camelCaseRE","toDash","left","right","camelCaseToDash","s","replace","classNames","names","args","arg","join","CodeArea","heading","extra","settings","File","handleRegisterAPI","codeAPI","register","section","unregister","width","mimeType","mime","lookup","initialized","json","model","layout","screen","init","uiStateValidator","Files","onSetSizes","sizes","uiModel","kUIStateKey","handleRegister","handleUnregister","fileToKeyMap","uiStateKey","i","test","Date","now","Math","random","forEach","direction","minSize","computeNewSizesFn","moveGuttersComputeNewSizes","getFileKey","desc","onTitleChange","LogManager","clear","_msgs","_notify","_addMsg","lastData","oldMsg","newMsg","isMsgSame","count","addMsg","addMsgs","msgs","showStack","Log","handleChange","logMessagesRef","logManager","prevProps","prevState","snapshot","elem","scrollTop","scrollHeight","parentElement","clientHeight","onGoToLine","getMsgs","msg","tooltip","fileLink","data-tooltip","lastIndexOf","basename","Runner","handleJSLog","handleJSError","handleJSUnhandledRejection","handleInfoMessages","handleGimmeDaCodez","iframe","handleMessage","runnerRef","run","blank","removeIFrame","background","Layout3Vertical","onSetVSizes","vSizes","onSetHSizes","hSizes","registerFilesAPI","filesAPI","handleGoToLine","registerRunnerAPI","Layout3Horizontal","onSetTSizes","tSizes","onSetBSizes","bSizes","findNdx","endings","ending","findIndex","endsWith","getOrFindNdx","f","getOrFind","sep","NamedFile","Layout2x2","onSetV1Sizes","v1Sizes","onSetV2Sizes","v2Sizes","mainHTMLNdx","mainJSNdx","mainCSSNdx","fixSizes","lastSizes","oldSize","availableSpace","len","sum","newSizes","layoutModes","setSizes","currentNdx","showResult","showLow","toggleShowLog","showLog","toggleShowResult","previousNdx","resultStyle","logStyle","IDE","gistSchema","gistsSchema","ajv","gistsValidator","gistValidator","getStoredGists","addGist","_public","saveGistsToLocalStorage","removeGist","setGists","LoadGist","handleNewGists","toggleCheck","checks","has","loadGists","loading","getUserGists","gistArray","deleteSelected","_gists","ids","deleteGist","clearBackup","backupManager","canLoad","sort","b","gistsToSortedArray","disabled","substring","matchFilter","encodeURIComponent","renderLoad","LoadJSON","useState","setJSON","useContext","onLoad","LoadURL","setUrl","fetch","req","Section","Load","utf8Encoder","TextEncoder","utf8Decoder","TextDecoder","isCompressedBase64","compressedBase64ToJSON","isCompressed","base64","raw","Uint8Array","decode","bin","inflate","idRE","isGistId","loadGistFromSrc","getGist","res","getTokenURL","process","OAuthManager","_popup","_state","_storageManager","requestToken","client","code","access_token","console","error","logout","_closePopup","client_id","scope","config","top","screenY","outerHeight","screenX","outerWidth","open","createPopup","close","Embed","exampleId","userSelect","indent4","split","Export","asModule","exportToCodepen","mainHTML","mainJS","mainCSS","pen","editors","html","css","js","innerHTML","querySelector","submit","openInCodepen","exportToJSFiddle","openInJSFiddle","overflow","makeSnippet","module","makeHTML","SaveAsGist","onPatChange","toggleSecret","saveNew","saving","onSave","success","createGist","saveOverExisting","forkAndSave","forkGist","newId","gistOwnerId","canUpdate","canFork","data-type","renderSave","SaveAsJSON","SaveAsURL","encode","compressed","deflate","useCompressed","jsonToCompressedBase64","class","Save","RadioOption","selected","radioSelected","Radio","selectedNdx","childNdx","newChildren","Children","isValidElement","cloneElement","Logout","handleLogout","Settings","handleLayoutChange","verticalIcon","horizontalIcon","twoByTwoIcon","tabbedIcon","UserManager","oauthManager","_handleNewAuth","setPat","getAuthenticatedUser","noJSX","App","handleNewGist","warn","handleRun","log","messages","setTimeout","addInfo","closeDialog","dialog","runnerAPI","handleStop","handleNew","setBackup","handleSave","handleSettings","renderSettings","handleHelp","renderHelp","handleLoad","handleOnLoad","handleOnSave","history","pushState","handleAbort","abort","path","pathname","dark","updateVersion","query","fromEntries","newGist","opener","backup","getBackup","loaded","loadData","updateTitle","Provider","Boolean","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","catch","exports"],"mappings":"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","file":"static/js/main.ba0a3b9b.chunk.js","sourcesContent":["import './scrollbars.css';\n\n/*\n * Scrollbar Width Test\n * Adds `layout-scrollbar-obtrusive` class to body if scrollbars use up screen real estate\n */\nconst parent = document.createElement(\"div\");\nparent.setAttribute(\"style\", \"width:30px;height:30px;\");\nparent.classList.add('scrollbar-test');\n\nconst child = document.createElement(\"div\");\nchild.setAttribute(\"style\", \"width:100%;height:40px\");\nparent.appendChild(child);\ndocument.body.appendChild(parent);\n\n// Measure the child element, if it is not\n// 30px wide the scrollbars are obtrusive.\nconst scrollbarWidth = 30 - parent.firstChild.clientWidth;\nif(scrollbarWidth) {\n  document.body.classList.add(\"layout-scrollbar-obtrusive\");\n}\n\ndocument.body.removeChild(parent);","const backupKey = 'backup';\r\n\r\nexport default class BackupManager {\r\n  #storageManager;\r\n\r\n  constructor(storageManager) {\r\n    this.#storageManager = storageManager;\r\n  }\r\n  getBackup() {\r\n    return this.#storageManager.get(backupKey);\r\n  }\r\n  setBackup(data) {\r\n    this.#storageManager.set(backupKey, data);\r\n  }\r\n  clearBackup() {\r\n    this.#storageManager.delete(backupKey);\r\n  }\r\n}","import React from 'react';\n\nexport default function EditLine(props) {\n  return (\n    <input\n      type=\"text\"\n      onChange={(e) => {props.onChange(e.target.value)}}\n      placeholder={props.placeholder}\n      value={props.value} />\n  );\n}","import React from 'react';\nimport {Controlled as CodeMirror} from 'react-codemirror2';\nimport 'codemirror/lib/codemirror.css';\nimport 'codemirror/theme/material.css';\nimport 'codemirror/theme/eclipse.css';\nimport 'codemirror/mode/css/css.js';\nimport 'codemirror/mode/gfm/gfm.js';\nimport 'codemirror/mode/htmlmixed/htmlmixed.js';\nimport 'codemirror/mode/javascript/javascript.js';\nimport 'codemirror/addon/scroll/simplescrollbars.js';\nimport 'codemirror/addon/scroll/simplescrollbars.css';\nimport 'codemirror/addon/search/search.js';\nimport 'codemirror/addon/search/searchcursor.js';\nimport 'codemirror/addon/search/jump-to-line.js';\nimport 'codemirror/addon/dialog/dialog.js';\nimport 'codemirror/addon/dialog/dialog.css';\nimport 'codemirror/addon/edit/matchbrackets.js';\nimport 'codemirror/addon/edit/matchtags.js';\nimport 'codemirror/addon/fold/xml-fold.js';\n\nconst darkMatcher = window.matchMedia\n    ? window.matchMedia('(prefers-color-scheme: dark)')\n    : {};\n// darkMatcher.addListener(render);\n\nconst noop = () => {};\n\nexport default class Code extends React.Component {\n  constructor(props) {\n    super(props);\n    const {value, hackKey} = props;\n    this.state = {value, hackKey}\n  }\n  static getDerivedStateFromProps(props, state) {\n    const needNewData = state.hackKey !== props.hackKey;\n    return (needNewData)\n       ? {hackKey: props.hackKey, value: props.value}\n       : null;\n  }\n  componentDidMount() {\n    const {registerAPI} = this.props;\n    if (registerAPI) {\n      registerAPI({\n        goToLine: (lineNo, colNo) => {\n          this.editor.focus();\n          this.editor.doc.setCursor(lineNo - 1, colNo - 1);\n        },\n        refresh: _ => {\n          this.editor.refresh();\n        },\n        focus: _ => {\n          this.editor.focus();\n        },\n      });\n    }\n  }\n  registerEditor = (editor) => {\n    this.editor = editor;\n  }\n  render() {\n    const {options = {}, onValueChange = noop} = this.props;\n    const {value} =  this.state;\n    const isDarkMode = darkMatcher.matches;\n    const codeMirrorOptions = {\n      mode: 'javascript',\n      scrollbarStyle: 'overlay',\n      theme: isDarkMode ? 'material' : 'eclipse',\n      matchBrackets: true,\n      lineNumbers: true,\n      ...(options.editor && options.editor),\n    };\n    if (codeMirrorOptions.mode.indexOf('html') >= 0) {\n      codeMirrorOptions.matchTags = true;\n    }\n    return (\n      <CodeMirror\n        value={value}\n        options={codeMirrorOptions}\n        onBeforeChange={(editor, data, value) => {\n          this.setState({value});\n        }}\n        onChange={(editor, data, value) => {\n          onValueChange(value);\n        }}\n        editorDidMount={this.registerEditor}\n      />\n    );\n  }\n};\n","import React from 'react';\n\nconst ServiceContext = React.createContext();\nexport default ServiceContext;\n","export function createURL(base, params) {\n  const url = new URL(base);\n  const searchParams = new URLSearchParams(url.search);\n  for (const [key, value] of Object.entries(params)) {\n    if (value === undefined) {\n      searchParams.delete(key);\n    } else {\n      searchParams.set(key, value);\n    }\n  }\n  url.search = searchParams.toString();\n  return url.href;\n}\n\nexport function updateURL(params) {\n  const url = createURL(window.location.href, params);\n  window.history.replaceState({}, '', url.href);\n}\n\n","type Handler = (data: any) => void;\ntype StringToHandlers = Map<string, Handler[]>;\nconst nullHandlers : StringToHandlers = new Map();\nconst fromToHandlersMap : Map<Window | null, StringToHandlers> = new Map([[null, nullHandlers]]);\n\nexport function on(type: string, from: Window | null, fn: (data: any) => void) {\n  remove(type, from, fn);\n  let handlers = fromToHandlersMap.get(from);\n  if (!handlers) {\n    handlers = new Map();\n    fromToHandlersMap.set(from, handlers)\n  }\n  let fns = handlers.get(type);\n  if (!fns) {\n    fns = [];\n    handlers.set(type, fns);\n  }\n  fns.push(fn);\n}\n\nexport function remove(type: string, from: Window | null, fn: (data: any) => void) {\n  let handlers = fromToHandlersMap.get(from);\n  if (!handlers) {\n    return;\n  }\n  const fns = handlers.get(type);\n  if (fns) {\n    const ndx = fns.indexOf(fn);\n    if (ndx >= 0) {\n      fns.splice(ndx, 1);\n    }\n    if (fns.length === 0) {\n      handlers.delete(type);\n      if (handlers.size === 0 && from) {\n        fromToHandlersMap.delete(from);\n      }\n    }\n  }\n}\n\nfunction callHandler(handlers: StringToHandlers, type: string, data: any) {\n  const fns = handlers.get(type);\n  if (fns) {\n    for (const fn of fns) {\n      fn(data);\n    }\n    return true;\n  }\n  return false;\n}\n\nwindow.addEventListener('message', (e: MessageEvent) => {\n  const {type, data} = e.data;\n  const handlers = fromToHandlersMap.get(e.source as Window);\n  if (handlers) {\n    if (callHandler(handlers, type, data)) {\n      return;\n    }\n  }\n  callHandler(nullHandlers, type, data);\n});\n\n","import React from 'react';\n\nimport Code from './Code.js';\nimport {isDevelopment} from '../libs/flags.js';\nimport ServiceContext from '../ServiceContext.js';\nimport {createURL} from '../libs/url.js';\nimport * as winMsgMgr from '../libs/WindowMessageManager';\n\nconst helperUrl = isDevelopment\n    ? 'http://localhost:8080/gist-comments.js'\n    : `${window.location.origin}/gist-comments.js`;\n\nclass Preview extends React.Component {\n  constructor(props) {\n    super(props);\n    this.iframeRef = React.createRef();\n    this.show = props.show;\n  }\n  handleSendPreview = () => {\n    const {body} = this.props;\n    this.iframeRef.current.contentWindow.postMessage({type: 'preview', data: {body}}, '*');\n  }\n  handleResize = (data) => {\n    this.iframeRef.current.style.height = `${data.height}px`;\n  }\n  componentDidMount() {\n    winMsgMgr.on('sendPreview', this.iframeRef.current.contentWindow, this.handleSendPreview);\n    winMsgMgr.on('resize', this.iframeRef.current.contentWindow, this.handleResize);\n  }\n  componentDidUpdate() {\n    if (this.props.show !== this.show) {\n      this.show = this.props.show;\n      if (this.show) {\n        this.handleSendPreview();\n      }\n    }\n  }\n  componentWillUnmount() {\n    winMsgMgr.remove('sendPreview', this.iframeRef.current.contentWindow, this.handleSendPreview);\n    winMsgMgr.remove('resize', this.iframeRef.current.contentWindow, this.handleResize);\n  }\n  render() {\n    const url = createURL('https://jsgist.devcomments.org/gist-comments.html', {preview: true, url: helperUrl});\n    return (\n      <iframe title=\"comment-preview\" ref={this.iframeRef} src={url} />\n    );\n  }\n}\n\nexport default class GistComment extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      value: isDevelopment ? `# this is a test\n\n\\`\\`\\`js\nconst a = b + c;\n\\`\\`\\`\n\nfoo *bar* **moo** \\`code\\` etc...\n\n1. this\n2. that\n3. other\n\n* banana\n* apple\n* grape\n\n\\`\\`\\`html\n<div>some long line that needs scrolling some long line that needs scrolling some long line that needs scrolling some long line that needs scrolling some long line that needs scrolling some long line that needs scrolling some long line that needs scrolling some long line that needs scrolling </div>\n\\`\\`\\`\n` : '',\n      tab: 0,\n      previewKey: 1,\n    };\n  }\n  onUserStatusChange = () => {\n    this.forceUpdate();\n  }\n  componentDidMount() {\n    const {userManager} = this.context;\n    userManager.subscribe(this.onUserStatusChange);\n  }\n  componentWillUnmount() {\n    const {userManager} = this.context;\n    userManager.unsubscribe(this.onUserStatusChange);\n  }\n  onValueChange = (value) => {\n    this.setState({value});\n  }\n  handleOnChange = (tab) => {\n    this.setState({tab});\n  }\n  handleSaveComment = async() => {\n    const {github, addError} = this.context;\n    try {\n      const {gistId, addComment} = this.props;\n      const data = await github.createGistComment(gistId, this.state.value);\n      this.setState({\n        value: '',\n        previewKey: this.state.previewKey + 1,\n      });\n      addComment(data);\n    } catch (e) {\n      addError(e.message || e);\n    }\n  }\n  renderCommentForm() {\n    const {userManager} = this.context;\n    const userData = userManager.getUserData();\n    const {\n      value,\n      tab,\n      previewKey,\n    } = this.state;\n    const options = {\n      editor: {\n        mode: 'gfm',\n        lineNumbers: false,\n      },\n    };\n    const showPreview = tab === 1;\n    return (\n      <div className=\"new-comment\">\n        <div className=\"new-comment-head\">\n          {!!userData.login && <div className=\"username\"><a target=\"_blank\" rel=\"noopener noreferrer\" href={`https://github.com/${userData.login}`}>{userData.login}</a></div>}\n          {!!userData.avatar_url && <a className=\"user-avatar\" target=\"_blank\" rel=\"noopener noreferrer\" href={`https://github.com/${userData.login}`}><img className=\"avatar\" src={userData.avatar_url} alt=\"avatar\"/></a>}\n        </div>\n        <div className=\"new-comment-tabs\">\n          <input\n            type=\"radio\"\n            name=\"new-comment\"\n            id=\"write\"\n            checked={tab === 0}\n            onChange={_ => this.handleOnChange(0)}\n          />\n          <label htmlFor=\"write\">write</label>\n          <input\n            type=\"radio\"\n            name=\"new-comment\"\n            id=\"preview\"\n            checked={tab === 1}\n            onChange={_ => this.handleOnChange(1)}\n          />\n          <label htmlFor=\"preview\">preview</label>\n        </div>\n        <div className=\"new-comment-content\">\n          <div style={{...(tab === 1 && {display: 'none'})}} className=\"new-comment-write\">\n            <Code\n              hackKey={previewKey}\n              value={value}\n              options={options}\n              onValueChange={this.onValueChange}\n              registerAPI={_ => _}\n            />\n          </div>\n          <div className=\"new-comment-preview\" style={{...(!showPreview && {display: 'none'})}}>\n            <Preview key={previewKey} body={value} show={showPreview} />\n          </div>\n        </div>\n        <div className=\"new-comment-submit  \">\n          <button onClick={this.handleSaveComment}>Comment</button>\n        </div>\n      </div>\n    );\n  }\n  renderLogin() {\n    const {userManager} = this.context;\n    return (\n      <div className=\"new-comment\">\n        <button\n          onClick={userManager.login}\n        >Login with github</button>\n      </div>\n    )\n  }\n  render() {\n    const {userManager} = this.context;\n    const userData = userManager.getUserData();\n    return (userData\n      ? this.renderCommentForm()\n      : this.renderLogin()\n    );\n  }\n}\n\nGistComment.contextType = ServiceContext;\n","import React from 'react';\n\nimport {isDevelopment} from '../libs/flags.js';\nimport ServiceContext from '../ServiceContext.js';\nimport {createURL} from '../libs/url.js';\nimport * as winMsgMgr from '../libs/WindowMessageManager';\n\nconst helperUrl = isDevelopment\n    ? 'http://localhost:8080/gist-comments.js'\n    : `${window.location.origin}/gist-comments.js`;\n\n\n// Comments are served from a separate domain in an iframe.\n// This is because comments have user data that is turned\n// into HTML. Of course we should sanitize but if we have\n// a bug we can't let it be on our page directly\n// otherwise it could read our secrets\n//\nexport default class GistComments extends React.Component {\n  constructor() {\n    super();\n    this.iframeRef = React.createRef();\n  }\n  // Our script creates an iframe and the content in the iframe\n  // communicates back to the main page to tell it the size of the content\n  // so the main page can adjust the iframe size.\n  handleResize = (data) => {\n    this.iframeRef.current.style.height = `${data.height}px`;\n  }\n  addComment = (data) => {\n    this.iframeRef.current.contentWindow.postMessage({\n      type: 'addComment',\n      data,\n    }, '*');\n  }\n  componentDidMount() {\n    winMsgMgr.on('resize', this.iframeRef.current.contentWindow, this.handleResize);\n    this.props.registerAPI({\n      addComment: this.addComment,\n    });\n  }\n  componentWillUnmount() {\n    winMsgMgr.remove('resize', this.iframeRef.current.contentWindow, this.handleResize);\n  }\n  shouldComponentUpdate(nextProps) {\n    return nextProps.disqusId !== this.disqusId;\n  }\n  render() {\n    const {userManager} = this.context;\n    const userData = userManager.getUserData() || {};\n    const {gistId} = this.props;\n    const url = createURL('https://jsgist.devcomments.org/gist-comments.html', {gist_id: gistId, url: helperUrl, gitUserId: userData.id});\n    return (\n      <div>\n        { !!gistId &&\n          <iframe\n            ref={this.iframeRef}\n            title=\"comments\"\n            src={url}\n          />\n        }\n      </div>\n    );\n  }\n}\n\nGistComments.contextType = ServiceContext;\n","\nimport React from 'react';\nimport GistComment from './GistComment.js';\nimport GistComments from './GistComments.js';\n\nexport default class Footer extends React.Component {\n  registerAPI = (api) => {\n    this.api = api;\n  }\n  addComment = (data) => {\n    this.api.addComment(data);\n  }\n  render() {\n    const {gistId, title} = this.props;\n    return (\n      <div className=\"comments\">\n        <hr/>\n        {\n          gistId &&\n            <React.Fragment>\n              <GistComments gistId={gistId} title={title} registerAPI={this.registerAPI} />\n              <GistComment gistId={gistId} addComment={this.addComment} />\n            </React.Fragment>\n        }\n      </div>\n    );\n  }\n}","\nexport default class SubscriptionManager {\n  itemToSubscriptionMap: Map<string, (() => void)[]>;\n  constructor() {\n    this.itemToSubscriptionMap = new Map();\n  }\n  subscribe(item: string, fn: () => void) {\n    this.unsubscribe(item, fn);\n    let fns = this.itemToSubscriptionMap.get(item);\n    if (!fns) {\n      fns = [];\n      this.itemToSubscriptionMap.set(item, fns);\n    }\n    fns.push(fn);\n  }\n  unsubscribe(item: string, fn: () => void): void {\n    const fns = this.itemToSubscriptionMap.get(item);\n    if (fns) {\n      const ndx = fns.indexOf(fn);\n      if (ndx >= 0) {\n        fns.splice(ndx, 1);\n        if (fns.length === 0) {\n          this.itemToSubscriptionMap.delete(item);\n        }\n      }\n    }\n  }\n  notify(item: string): void {\n    const fns = this.itemToSubscriptionMap.get(item);\n    if (fns) {\n      for (const fn of fns.slice()) {\n        fn();\n      }\n    }\n  }\n}","import StorageManager from './libs/StorageManager';\nimport {isDevelopment} from './libs/flags.js';\n\nexport const storageManager = new StorageManager('jsgist');\nexport const clientId = isDevelopment\n    ? 'b7822ff167d2bbe9a361'\n    : 'c055b54872b13c10e4bd';\n\n","import SubscriptionManager from './SubscriptionManager';\n\nexport default class StorageManager {\n  prefix: string;\n  subscriptionManager: SubscriptionManager;\n\n  constructor(prefix: string) {\n    this.prefix = `${prefix}-`;\n    this.subscriptionManager = new SubscriptionManager();\n    window.addEventListener('storage', this._handleNewValue);\n  }\n  private _handleNewValue = (e: StorageEvent) => {\n    const key = e.key;\n    if (key && key.startsWith(this.prefix)) {\n      const unPrefixedKey = key.substr(this.prefix.length);\n      this.subscriptionManager.notify(unPrefixedKey);\n    }\n  }\n  private _addPrefix(key: string): string {\n    return `${this.prefix}${key}`;\n  }\n  subscribe(key: string, fn: () => void): void {\n    this.subscriptionManager.subscribe(key, fn);\n  }\n  unsubscribe(key: string, fn: () => void): void {\n    this.subscriptionManager.unsubscribe(key, fn);\n  }\n  get(key: string, session = false) {\n    const k = this._addPrefix(key);\n    if (session) {\n      const v = sessionStorage.getItem(k);\n      if (v) {\n        return v;\n      }\n    }\n    return localStorage.getItem(k);\n  }\n  set(key: string, value: string, session = false) {\n    const k = this._addPrefix(key);\n    if (session) {\n      sessionStorage.setItem(k, value);\n    }\n    localStorage.setItem(k, value);\n    this.subscriptionManager.notify(key);\n  }\n  delete(key: string, session = false) {\n    const k = this._addPrefix(key);\n    if (session) {\n      sessionStorage.removeItem(k);\n    }\n    localStorage.removeItem(k);\n    this.subscriptionManager.notify(key);\n  }\n  cleanup() {\n    window.removeEventListener('storage', this._handleNewValue);\n  }\n}\n","import { Octokit } from '@octokit/rest';\n\nconst userAgent = 'jsGist v0.0.1';\nconst emptyValue = '/*bug-in-github-api-content-can-not-be-empty*/';\n\nfunction getEmptyFileHack(file) {\n  return file.content.startsWith(emptyValue)\n                ? file.content.substr(emptyValue.length)\n                : file.content;\n}\n\n// there are 3 forms current\n//\n// 1. files are stored by filename (legacy)\n// 2. files are stored as JSON (this happens if there are any duplicate names)\n// 3. files are stored by filename and filenames references them in order\n\nexport function getGistContent(gist) {\n  const data = JSON.parse(gist.files['jsGist.json'].content);\n  // github stores files by filename but we need them in the same order in the array\n  // they started with so they go to the correct pane.\n  if (data.filenames) {\n    data.files = data.filenames.map(name => {\n      return {\n        name: name,\n        content: getEmptyFileHack(gist.files[name]),\n      };\n    });\n  } else {\n    // legacy path if there are no filenames\n    data.files = Object.entries(gist.files)\n      .filter(([name]) => name !== 'jsGist.json')\n      .map(([name, file]) => {\n        return {\n          name,\n          content: getEmptyFileHack(file),\n        }\n      }).concat(data.files || []);\n  }\n  return data;\n} \n\n/*\n  \"url\": \"https://api.github.com/gists/bad0a8491bd6614e729ff01cc14089c9\",\n  \"forks_url\": \"https://api.github.com/gists/bad0a8491bd6614e729ff01cc14089c9/forks\",\n  \"commits_url\": \"https://api.github.com/gists/bad0a8491bd6614e729ff01cc14089c9/commits\",\n  \"id\": \"bad0a8491bd6614e729ff01cc14089c9\",\n  \"node_id\": \"MDQ6R2lzdGJhZDBhODQ5MWJkNjYxNGU3MjlmZjAxY2MxNDA4OWM5\",\n  \"git_pull_url\": \"https://gist.github.com/bad0a8491bd6614e729ff01cc14089c9.git\",\n  \"git_push_url\": \"https://gist.github.com/bad0a8491bd6614e729ff01cc14089c9.git\",\n  \"html_url\": \"https://gist.github.com/bad0a8491bd6614e729ff01cc14089c9\",\n  \"files\": {\n    \"index.css\": {\n      \"filename\": \"index.css\",\n      \"type\": \"text/css\",\n      \"language\": \"CSS\",\n      \"raw_url\": \"https://gist.githubusercontent.com/greggman/bad0a8491bd6614e729ff01cc14089c9/raw/1847e2c75f6b76223402f69bada71e72db880605/index.css\",\n      \"size\": 243,\n      \"truncated\": false,\n      \"content\": \"body {\\n  margin: 0;\\n}\\n#c {\\n  width: 100vw;\\n  height: 100vh;\\n  display: block;\\n}\\n#info { \\n  position: absolute; \\n  left: 1em; \\n  top: 1em; \\n  background: rgba(0,0,0,.8); \\n  padding: .5em;\\n        color: white;\\n        font-family: monospace;\\n}\\n\"\n    },\n    \"index.html\": {\n      \"filename\": \"index.html\",\n      \"type\": \"text/html\",\n      \"language\": \"HTML\",\n      \"raw_url\": \"https://gist.githubusercontent.com/greggman/bad0a8491bd6614e729ff01cc14089c9/raw/c9e9e838f601e2d98d448b035ce3052629969c11/index.html\",\n      \"size\": 46,\n      \"truncated\": false,\n      \"content\": \"<canvas id=\\\"c\\\"></canvas>\\n<div id=\\\"info\\\"></div>\"\n    },\n    \"index.js\": {\n      \"filename\": \"index.js\",\n      \"type\": \"application/javascript\",\n      \"language\": \"JavaScript\",\n      \"raw_url\": \"https://gist.githubusercontent.com/greggman/bad0a8491bd6614e729ff01cc14089c9/raw/77a7fca481ff157da44f4196ce253ea282f0abdc/index.js\",\n      \"size\": 8413,\n      \"truncated\": false,\n      \"content\": \"import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r119/build/three.module.js';\\n\\nfunction main() {\\n  const canvas = document.querySelector('#c');\\n  const renderer = new THREE.WebGLRenderer({canvas: canvas});\\n  renderer.setClearColor(0x88AACC);\\n  renderer.shadowMap.enabled = true;\\n\\n  function makeCamera(fov = 40) {\\n    const aspect = 2;  // the canvas default\\n    const zNear = 0.1;\\n    const zFar = 1000;\\n    return new THREE.PerspectiveCamera(fov, aspect, zNear, zFar);\\n  }\\n  const camera = makeCamera();\\n  camera.position.set(8, 4, 10).multiplyScalar(3);\\n  camera.lookAt(0, 0, 0);\\n\\n  const scene = new THREE.Scene();\\n\\n  {\\n    const light = new THREE.DirectionalLight(0xffffff, 1);\\n    light.position.set(0, 20, 0);\\n    scene.add(light);\\n    light.castShadow = true;\\n    light.shadow.mapSize.width = 2048;\\n    light.shadow.mapSize.height = 2048;\\n\\n    const d = 50;\\n    light.shadow.camera.left = -d;\\n    light.shadow.camera.right = d;\\n    light.shadow.camera.top = d;\\n    light.shadow.camera.bottom = -d;\\n    light.shadow.camera.near = 1;\\n    light.shadow.camera.far = 50;\\n    light.shadow.bias = 0.001;\\n  }\\n\\n  {\\n    const light = new THREE.DirectionalLight(0xffffff, 1);\\n    light.position.set(1, 2, 4);\\n    scene.add(light);\\n  }\\n\\n  const groundGeometry = new THREE.PlaneBufferGeometry(50, 50);\\n  const groundMaterial = new THREE.MeshPhongMaterial({color: 0xCC8866});\\n  const groundMesh = new THREE.Mesh(groundGeometry, groundMaterial);\\n  groundMesh.rotation.x = Math.PI * -.5;\\n  groundMesh.receiveShadow = true;\\n  scene.add(groundMesh);\\n\\n  const carWidth = 4;\\n  const carHeight = 1;\\n  const carLength = 8;\\n\\n  const tank = new THREE.Object3D();\\n  scene.add(tank);\\n\\n  const bodyGeometry = new THREE.BoxBufferGeometry(carWidth, carHeight, carLength);\\n  const bodyMaterial = new THREE.MeshPhongMaterial({color: 0x66AA88});\\n  const bodyMesh = new THREE.Mesh(bodyGeometry, bodyMaterial);\\n  bodyMesh.position.y = 1.4;\\n  bodyMesh.castShadow = true;\\n  tank.add(bodyMesh);\\n\\n  const tankCameraFov = 75;\\n  const tankCamera = makeCamera(tankCameraFov);\\n  tankCamera.position.y = 3;\\n  tankCamera.position.z = -6;\\n  tankCamera.rotation.y = Math.PI;\\n  bodyMesh.add(tankCamera);\\n\\n  const wheelRadius = 1;\\n  const wheelThickness = .5;\\n  const wheelSegments = 6;\\n  const wheelGeometry = new THREE.CylinderBufferGeometry(\\n      wheelRadius,     // top radius\\n      wheelRadius,     // bottom radius\\n      wheelThickness,  // height of cylinder\\n      wheelSegments);\\n  const wheelMaterial = new THREE.MeshPhongMaterial({color: 0x888888});\\n  const wheelPositions = [\\n    [-carWidth / 2 - wheelThickness / 2, -carHeight / 2,  carLength / 3],\\n    [ carWidth / 2 + wheelThickness / 2, -carHeight / 2,  carLength / 3],\\n    [-carWidth / 2 - wheelThickness / 2, -carHeight / 2, 0],\\n    [ carWidth / 2 + wheelThickness / 2, -carHeight / 2, 0],\\n    [-carWidth / 2 - wheelThickness / 2, -carHeight / 2, -carLength / 3],\\n    [ carWidth / 2 + wheelThickness / 2, -carHeight / 2, -carLength / 3],\\n  ];\\n  const wheelMeshes = wheelPositions.map((position) => {\\n    const mesh = new THREE.Mesh(wheelGeometry, wheelMaterial);\\n    mesh.position.set(...position);\\n    mesh.rotation.z = Math.PI * .5;\\n    mesh.castShadow = true;\\n    bodyMesh.add(mesh);\\n    return mesh;\\n  });\\n\\n  const domeRadius = 2;\\n  const domeWidthSubdivisions = 12;\\n  const domeHeightSubdivisions = 12;\\n  const domePhiStart = 0;\\n  const domePhiEnd = Math.PI * 2;\\n  const domeThetaStart = 0;\\n  const domeThetaEnd = Math.PI * .5;\\n  const domeGeometry = new THREE.SphereBufferGeometry(\\n    domeRadius, domeWidthSubdivisions, domeHeightSubdivisions,\\n    domePhiStart, domePhiEnd, domeThetaStart, domeThetaEnd);\\n  const domeMesh = new THREE.Mesh(domeGeometry, bodyMaterial);\\n  domeMesh.castShadow = true;\\n  bodyMesh.add(domeMesh);\\n  domeMesh.position.y = .5;\\n\\n  const turretWidth = .1;\\n  const turretHeight = .1;\\n  const turretLength = carLength * .75 * .2;\\n  const turretGeometry = new THREE.BoxBufferGeometry(\\n      turretWidth, turretHeight, turretLength);\\n  const turretMesh = new THREE.Mesh(turretGeometry, bodyMaterial);\\n  const turretPivot = new THREE.Object3D();\\n  turretMesh.castShadow = true;\\n  turretPivot.scale.set(5, 5, 5);\\n  turretPivot.position.y = .5;\\n  turretMesh.position.z = turretLength * .5;\\n  turretPivot.add(turretMesh);\\n  bodyMesh.add(turretPivot);\\n\\n  const turretCamera = makeCamera();\\n  turretCamera.position.y = .75 * .2;\\n  turretMesh.add(turretCamera);\\n\\n  const targetGeometry = new THREE.SphereBufferGeometry(.5, 6, 3);\\n  const targetMaterial = new THREE.MeshPhongMaterial({color: 0x00FF00, flatShading: true});\\n  const targetMesh = new THREE.Mesh(targetGeometry, targetMaterial);\\n  const targetOrbit = new THREE.Object3D();\\n  const targetElevation = new THREE.Object3D();\\n  const targetBob = new THREE.Object3D();\\n  targetMesh.castShadow = true;\\n  scene.add(targetOrbit);\\n  targetOrbit.add(targetElevation);\\n  targetElevation.position.z = carLength * 2;\\n  targetElevation.position.y = 8;\\n  targetElevation.add(targetBob);\\n  targetBob.add(targetMesh);\\n\\n  const targetCamera = makeCamera();\\n  const targetCameraPivot = new THREE.Object3D();\\n  targetCamera.position.y = 1;\\n  targetCamera.position.z = -2;\\n  targetCamera.rotation.y = Math.PI;\\n  targetBob.add(targetCameraPivot);\\n  targetCameraPivot.add(targetCamera);\\n\\n  // Create a sine-like wave\\n  const curve = new THREE.SplineCurve( [\\n    new THREE.Vector2( -10, 0 ),\\n    new THREE.Vector2( -5, 5 ),\\n    new THREE.Vector2( 0, 0 ),\\n    new THREE.Vector2( 5, -5 ),\\n    new THREE.Vector2( 10, 0 ),\\n    new THREE.Vector2( 5, 10 ),\\n    new THREE.Vector2( -5, 10 ),\\n    new THREE.Vector2( -10, -10 ),\\n    new THREE.Vector2( -15, -8 ),\\n    new THREE.Vector2( -10, 0 ),\\n  ] );\\n\\n  const points = curve.getPoints( 50 );\\n  const geometry = new THREE.BufferGeometry().setFromPoints( points );\\n  const material = new THREE.LineBasicMaterial( { color : 0xff0000 } );\\n  const splineObject = new THREE.Line( geometry, material );\\n  splineObject.rotation.x = Math.PI * .5;\\n  splineObject.position.y = 0.05;\\n  scene.add(splineObject);\\n\\n  function resizeRendererToDisplaySize(renderer) {\\n    const canvas = renderer.domElement;\\n    const width = canvas.clientWidth;\\n    const height = canvas.clientHeight;\\n    const needResize = canvas.width !== width || canvas.height !== height;\\n    if (needResize) {\\n      renderer.setSize(width, height, false);\\n    }\\n    return needResize;\\n  }\\n\\n  const targetPosition = new THREE.Vector3();\\n  const tankPosition = new THREE.Vector2();\\n  const tankTarget = new THREE.Vector2();\\n\\n  const cameras = [\\n    { cam: camera, desc: 'detached camera', },\\n    { cam: turretCamera, desc: 'on turret looking at target', },\\n    { cam: targetCamera, desc: 'near target looking at tank', },\\n    { cam: tankCamera, desc: 'above back of tank', },\\n  ];\\n\\n  const infoElem = document.querySelector('#info');\\n\\n  function render(time) {\\n    time *= 0.001;\\n\\n    if (resizeRendererToDisplaySize(renderer)) {\\n      const canvas = renderer.domElement;\\n      cameras.forEach((cameraInfo) => {\\n        const camera = cameraInfo.cam;\\n        camera.aspect = canvas.clientWidth / canvas.clientHeight;\\n        camera.updateProjectionMatrix();\\n      });\\n    }\\n\\n    // move target\\n    targetOrbit.rotation.y = time * .27;\\n    targetBob.position.y = Math.sin(time * 2) * 4;\\n    targetMesh.rotation.x = time * 7;\\n    targetMesh.rotation.y = time * 13;\\n    targetMaterial.emissive.setHSL(time * 10 % 1, 1, .25);\\n    targetMaterial.color.setHSL(time * 10 % 1, 1, .25);\\n\\n    // move tank\\n    const tankTime = time * .05;\\n    curve.getPointAt(tankTime % 1, tankPosition);\\n    curve.getPointAt((tankTime + 0.01) % 1, tankTarget);\\n    tank.position.set(tankPosition.x, 0, tankPosition.y);\\n    tank.lookAt(tankTarget.x, 0, tankTarget.y);\\n\\n    // face turret at target\\n    targetMesh.getWorldPosition(targetPosition);\\n    turretPivot.lookAt(targetPosition);\\n\\n    // make the turretCamera look at target\\n    turretCamera.lookAt(targetPosition);\\n\\n    // make the targetCameraPivot look at the at the tank\\n    tank.getWorldPosition(targetPosition);\\n    targetCameraPivot.lookAt(targetPosition);\\n\\n    wheelMeshes.forEach((obj) => {\\n      obj.rotation.x = time * 3;\\n    });\\n\\n    const camera = cameras[time * .25 % cameras.length | 0];\\n    infoElem.textContent = camera.desc;\\n\\n    renderer.render(scene, camera.cam);\\n\\n    requestAnimationFrame(render);\\n  }\\n\\n  requestAnimationFrame(render);\\n}\\n\\nmain();\\n\"\n    },\n    \"jsGist.json\": {\n      \"filename\": \"jsGist.json\",\n      \"type\": \"application/json\",\n      \"language\": \"JSON\",\n      \"raw_url\": \"https://gist.githubusercontent.com/greggman/bad0a8491bd6614e729ff01cc14089c9/raw/ac014ca1eb788c3c05b1612902b142f59fca3f7c/jsGist.json\",\n      \"size\": 60,\n      \"truncated\": false,\n      \"content\": \"{\\\"name\\\":\\\"ThreeJSFundamentals Scenegraph Tank\\\",\\\"settings\\\":{}}\"\n    }\n  },\n  \"public\": true,\n  \"created_at\": \"2020-10-11T08:16:53Z\",\n  \"updated_at\": \"2020-11-04T17:41:21Z\",\n  \"description\": \"ThreeJSFundamentals Scenegraph Tank\",\n  \"comments\": 9,\n  \"user\": null,\n  \"comments_url\": \"https://api.github.com/gists/bad0a8491bd6614e729ff01cc14089c9/comments\",\n  \"owner\": {\n    \"login\": \"greggman\",\n    \"id\": 234804,\n    \"node_id\": \"MDQ6VXNlcjIzNDgwNA==\",\n    \"avatar_url\": \"https://avatars2.githubusercontent.com/u/234804?v=4\",\n    \"gravatar_id\": \"\",\n    \"url\": \"https://api.github.com/users/greggman\",\n    \"html_url\": \"https://github.com/greggman\",\n    \"followers_url\": \"https://api.github.com/users/greggman/followers\",\n    \"following_url\": \"https://api.github.com/users/greggman/following{/other_user}\",\n    \"gists_url\": \"https://api.github.com/users/greggman/gists{/gist_id}\",\n    \"starred_url\": \"https://api.github.com/users/greggman/starred{/owner}{/repo}\",\n    \"subscriptions_url\": \"https://api.github.com/users/greggman/subscriptions\",\n    \"organizations_url\": \"https://api.github.com/users/greggman/orgs\",\n    \"repos_url\": \"https://api.github.com/users/greggman/repos\",\n    \"events_url\": \"https://api.github.com/users/greggman/events{/privacy}\",\n    \"received_events_url\": \"https://api.github.com/users/greggman/received_events\",\n    \"type\": \"User\",\n    \"site_admin\": false\n  },\n  \"forks\": [\n\n  ],\n  \"history\": [\n    {\n      \"user\": {\n        \"login\": \"greggman\",\n        \"id\": 234804,\n        \"node_id\": \"MDQ6VXNlcjIzNDgwNA==\",\n        \"avatar_url\": \"https://avatars2.githubusercontent.com/u/234804?v=4\",\n        \"gravatar_id\": \"\",\n        \"url\": \"https://api.github.com/users/greggman\",\n        \"html_url\": \"https://github.com/greggman\",\n        \"followers_url\": \"https://api.github.com/users/greggman/followers\",\n        \"following_url\": \"https://api.github.com/users/greggman/following{/other_user}\",\n        \"gists_url\": \"https://api.github.com/users/greggman/gists{/gist_id}\",\n        \"starred_url\": \"https://api.github.com/users/greggman/starred{/owner}{/repo}\",\n        \"subscriptions_url\": \"https://api.github.com/users/greggman/subscriptions\",\n        \"organizations_url\": \"https://api.github.com/users/greggman/orgs\",\n        \"repos_url\": \"https://api.github.com/users/greggman/repos\",\n        \"events_url\": \"https://api.github.com/users/greggman/events{/privacy}\",\n        \"received_events_url\": \"https://api.github.com/users/greggman/received_events\",\n        \"type\": \"User\",\n        \"site_admin\": false\n      },\n      \"version\": \"fcbedffeccec982c99bc3963ed77f41762a8dd5a\",\n      \"committed_at\": \"2020-10-17T02:08:28Z\",\n      \"change_status\": {\n        \"total\": 4,\n        \"additions\": 2,\n        \"deletions\": 2\n      },\n      \"url\": \"https://api.github.com/gists/bad0a8491bd6614e729ff01cc14089c9/fcbedffeccec982c99bc3963ed77f41762a8dd5a\"\n    },\n    {\n      \"user\": {\n        \"login\": \"greggman\",\n        \"id\": 234804,\n        \"node_id\": \"MDQ6VXNlcjIzNDgwNA==\",\n        \"avatar_url\": \"https://avatars2.githubusercontent.com/u/234804?v=4\",\n        \"gravatar_id\": \"\",\n        \"url\": \"https://api.github.com/users/greggman\",\n        \"html_url\": \"https://github.com/greggman\",\n        \"followers_url\": \"https://api.github.com/users/greggman/followers\",\n        \"following_url\": \"https://api.github.com/users/greggman/following{/other_user}\",\n        \"gists_url\": \"https://api.github.com/users/greggman/gists{/gist_id}\",\n        \"starred_url\": \"https://api.github.com/users/greggman/starred{/owner}{/repo}\",\n        \"subscriptions_url\": \"https://api.github.com/users/greggman/subscriptions\",\n        \"organizations_url\": \"https://api.github.com/users/greggman/orgs\",\n        \"repos_url\": \"https://api.github.com/users/greggman/repos\",\n        \"events_url\": \"https://api.github.com/users/greggman/events{/privacy}\",\n        \"received_events_url\": \"https://api.github.com/users/greggman/received_events\",\n        \"type\": \"User\",\n        \"site_admin\": false\n      },\n      \"version\": \"16bda36d8000991414a7240edaf7f5aa709183af\",\n      \"committed_at\": \"2020-10-11T08:16:53Z\",\n      \"change_status\": {\n        \"total\": 273,\n        \"additions\": 273,\n        \"deletions\": 0\n      },\n      \"url\": \"https://api.github.com/gists/bad0a8491bd6614e729ff01cc14089c9/16bda36d8000991414a7240edaf7f5aa709183af\"\n    }\n  ],\n  \"truncated\": false\n}\n*/\nexport async function getAnonGist(gist_id) {\n  const req = await fetch(`https://api.github.com/gists/${gist_id}`);\n  const gist = await req.json();\n  return {\n    data: getGistContent(gist),\n    rawData: gist,\n  };\n}\n\nexport function getUserData(data) {\n  return (data && data.owner)\n      ? {\n          name: data.owner.login,\n          avatarURL: data.owner.avatar_url,\n      }\n      : undefined;\n}\n\nfunction createGistData(data, secret, gist_id) {\n  let files = data.files.reduce((files, file) => {\n    files[file.name] = {\n      content: file.content.trim() ? file.content : `${emptyValue}${file.content}`,\n    };\n    return files;\n  }, {});\n  const saveData = {\n    ...data,\n  };\n  const jsGistData = {}\n  files['jsGist.json'] = jsGistData;\n  const noDuplicateNames = Object.keys(files).length === data.files.length + 1;\n  if (noDuplicateNames) {\n    delete saveData.files;\n    saveData.filenames = data.files.map(({name}) => name);\n  } else {\n    // save the files in the json\n    files = {\n      'jsGist.json': jsGistData,\n    };\n  }\n  jsGistData.content = JSON.stringify(saveData);\n  if (gist_id) {\n    // TODO: rather than check if there's a readme\n    // insert the readme in our wrapped readme.\n    // Maybe add a \"notes\" field to the save dialog\n    const lowerCaseFiles = Object.keys(files).map(n => n.toLowerCase());\n    const hadReadme = \n        lowerCaseFiles.includes('readme.md') ||\n        lowerCaseFiles.includes('readme.txt') ||\n        lowerCaseFiles.includes('readme');\n    if (!hadReadme) {\n      const content = `## ${data.name}\\n\\n[view on jsgist](${window.location.origin}?src=${gist_id})`\n      files['README.md'] = {content};\n    }\n    // if we have a gist_id this is an update\n    // updates need filenames (which allows renaming)\n    for (const [filename, file] of Object.entries(files)) {\n      file.filename = filename;\n    }\n  }\n  return {\n    files,\n    description: data.name,\n    ...(!gist_id && {public: !secret}),\n    ...(gist_id && {gist_id}),\n  };\n}\n\nexport default class GitHub extends EventTarget {\n  constructor() {\n    super();\n    this.pat = '';\n    this.user = {};\n    this.unAuthorizedOctokit = new Octokit({\n      userAgent,\n    });\n  }\n  get octokit() {\n    return this.authorizedOctokit || this.unAuthorizedOctokit;\n  }\n  // TODO: this does not belong here!\n  _updateUserData(data) {\n    const userData = getUserData(data);\n    if (userData) {\n      Object.assign(this.user, userData);\n      const event = new Event('userdata');\n      event.data = {...this.user};\n      this.dispatchEvent(event);\n    }\n  }\n  setPat(pat) {\n    if (pat !== this.pat) {\n      this.pat = pat;\n      if (pat) {\n        this.authorizedOctokit = new Octokit({\n          auth: pat,\n          userAgent,\n        });\n      } else {\n        this.authorizedOctokit = undefined;\n      }\n    }\n  }\n  /*\n  \"{\n    \"login\": \"greggman\",\n    \"id\": 234804,\n    \"node_id\": \"MDQ6VXNlcjIzNDgwNA==\",\n    \"avatar_url\": \"https://avatars2.githubusercontent.com/u/234804?v=4\",\n    \"gravatar_id\": \"\",\n    \"url\": \"https://api.github.com/users/greggman\",\n    \"html_url\": \"https://github.com/greggman\",\n    \"followers_url\": \"https://api.github.com/users/greggman/followers\",\n    \"following_url\": \"https://api.github.com/users/greggman/following{/other_user}\",\n    \"gists_url\": \"https://api.github.com/users/greggman/gists{/gist_id}\",\n    \"starred_url\": \"https://api.github.com/users/greggman/starred{/owner}{/repo}\",\n    \"subscriptions_url\": \"https://api.github.com/users/greggman/subscriptions\",\n    \"organizations_url\": \"https://api.github.com/users/greggman/orgs\",\n    \"repos_url\": \"https://api.github.com/users/greggman/repos\",\n    \"events_url\": \"https://api.github.com/users/greggman/events{/privacy}\",\n    \"received_events_url\": \"https://api.github.com/users/greggman/received_events\",\n    \"type\": \"User\",\n    \"site_admin\": false,\n    \"name\": \"Greggman\",\n    \"company\": null,\n    \"blog\": \"http://games.greggman.com\",\n    \"location\": \"Earth\",\n    \"email\": \"github@greggman.com\",\n    \"hireable\": null,\n    \"bio\": \"30 years of games\\r\\n5 years of Chrome\",\n    \"twitter_username\": null,\n    \"public_repos\": 283,\n    \"public_gists\": 79,\n    \"followers\": 1037,\n    \"following\": 3,\n    \"created_at\": \"2010-04-01T08:48:05Z\",\n    \"updated_at\": \"2020-10-24T06:05:24Z\"\n  }\"\n  */\n  async getAuthenticatedUser() {\n    const response = await this.authorizedOctokit.users.getAuthenticated();\n    if (response.status !== 200) {\n      throw new Error(response.message);\n    }\n    return response.data;\n  }\n\n  async getUserGists() {\n    const gists = await this.authorizedOctokit.paginate(\n        this.authorizedOctokit.gists.list,\n        {per_page: 100});\n    return gists.filter(gist => !!gist.files['jsGist.json']);\n    // return await this.authorizedOctokit.gists.list();\n  }\n\n  async getGist(gist_id) {\n    const octokit = this.authorizedOctokit || this.octokit;\n    const gist = await octokit.gists.get({gist_id});\n    return {\n      data: getGistContent(gist.data),\n      rawData: gist.data,\n    };\n  }\n\n  async createGist(data, secret = false) {\n    // TODO: Since we're doing the double save (create gist to get an id\n    // so we can make the README.me) we should probably not send any data\n    // the first time.\n    const gistData = createGistData(data, secret);\n    const gist = await this.authorizedOctokit.gists.create(gistData);\n    this._updateUserData(gist.data);\n    return await this.updateGist(gist.data.id, data);\n  }\n  async updateGist(gist_id, data) {\n    const gistData = createGistData(data, false, gist_id);\n    const gist = await this.authorizedOctokit.gists.update(gistData);\n    return {\n      id: gist.data.id,\n      name: gist.data.description,\n      date: gist.data.updated_at,\n      public: gist.data.public,\n    };\n  }\n  async forkGist(gist_id) {\n    const gist = await this.authorizedOctokit.gists.fork({gist_id});\n    return {\n      id: gist.data.id\n    };\n  }\n  async deleteGist(gist_id) {\n    const result = await this.authorizedOctokit.gists.delete({gist_id});\n    return result;\n  }\n  async createGistComment(gist_id, body) {\n    const result = await this.authorizedOctokit.gists.createComment({\n      gist_id,\n      body,\n    });\n    if (result.status < 200 || result.status >= 300) {\n      throw new Error(result.message);\n    }\n    return result.data;\n  }\n}\n\n","import React from 'react';\n\nexport default function Head() {\n  return (\n    <div className=\"head\">\n      <div>\n        <a target=\"_blank\" rel=\"noopener noreferrer\" href={window.location.origin}>\n        <img src=\"/resources/images/logo-small.svg\" alt=\"logo\"/>\n      jsGist.org<span className=\"beta\">(beta)</span></a>\n      </div>\n      <div className=\"fix-help-contribute\">\n        <div className=\"three-words\">\n          <div><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/greggman/jsgist/\">Fix</a></div>\n          <div><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/greggman/jsgist/\">Help</a></div>\n          <div><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/greggman/jsgist/\">Contribute</a></div>\n        </div>\n        <div className=\"octocat\">\n          <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/greggman/jsgist/\">\n            <img alt=\"github\" src=\"/resources/images/octocat-icon.svg\"/>\n          </a>\n        </div>\n      </div>\n    </div>\n  );\n}","import React from 'react';\n\nexport default class Dialog extends React.Component {\n  componentDidMount() {\n    window.addEventListener('keydown', this.handleKeyDown);\n  }\n  componentWillUnmount() {\n    window.removeEventListener('keydown', this.handleKeyDown);\n  }\n  handleKeyDown = (e) => {\n    if (e.keyCode === 27) {\n      this.props.onClose();\n    }\n  }\n  render() {\n    const {title, children, onClose, className = ''} = this.props;\n    return (\n      <div onClick={onClose} className={`${className} dialog`}>\n        <div\n          tabIndex=\"-1\"\n          onClick={(e) =>{e.stopPropagation()}}\n        >\n          <div className=\"dialog-heading\">\n            <div className=\"dialog-title\">{title}</div>\n            <div className=\"dialog-close\">\n              <button onClick={onClose}>X</button>\n            </div>\n          </div>\n          <div className=\"dialog-content\">\n            {children}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport Dialog from './Dialog.js';\n\nexport default function Help(props) {\n  const {onClose} = props;\n  return (\n    <Dialog title=\"jsGist\" onClose={onClose}>\n      <div className=\"markdown\">\n      <p>A gist based JavaScript/HTML/CSS Playground</p>\n      <h2>Contribute, Fix, Enhance!</h2>\n      <p>\n        <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/greggman/jsgist\">https://github.com/greggman/jsgist</a>\n      </p>\n      <p>Also see <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://jsbenchit.org\">jsbenchit.org</a></p>\n      <h2>Saving</h2>\n      <p>You can save your tests in multiple ways.</p>\n      <ol>\n        <li>Save to a github gist by logging in</li>\n        <li>Save it manually into github\n          <p>\n           Copy the JSON. Go to github. Create a new gist. Name the file\n           <code>jsGist.json</code> Paste the JSON in. Pick \"Create public gist\".\n          </p>\n          <p>\n           Note the id in the URL after you create the gist.\n          </p>\n          <p>\n           Create a url in the form <code>https://jsgist.org/?src=&lt;gist_id&gt;--</code>.\n          </p>\n          <p>\n           Example: <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://jsgist.org/?src=f793cb359f2571409983351a6099d5d1\">https://jsgist.org/?src=f793cb359f2571409983351a6099d5d1</a>\n          </p>\n        </li>\n        <li>Save it manually somewhere else.\n          <p>\n           If there's some other service that will provide a string via\n           http get then copy and save the JSON there then create a URL\n           in the form of <code>https://jsgist.org/?src=&lt;url&gt;</code>. Note: you\n           may have to escape the URL.\n          </p>\n        </li>\n        <li>Save it as a bookmark or link\n          <p>\n           In the SaveAs dialog there's a link that contains all the data\n           for your benchmark.\n          </p>\n        </li>\n      </ol>\n      </div>\n    </Dialog>\n  );\n}","import Ajv from 'ajv';\n\nimport {isDevelopment} from './flags.js';\nimport schema from './schema.json';\n\nconst ajv = new Ajv() // options can be passed, e.g. {allErrors: true}\nconst validator = ajv.compile(schema);\n\nconst trackedValues = {};\n\nfunction getValueOrMakeNew(name) {\n  const trackedValue = trackedValues[name] || {\n    subscriptions: new Set(),\n  };\n  trackedValues[name] = trackedValue;\n  return trackedValue;\n}\n\nexport function add(name, initialValue) {\n  const trackedValue = getValueOrMakeNew(name);\n  if (initialValue !== undefined) {\n    trackedValue.value = initialValue;\n  }\n  return trackedValue;\n}\n\nexport function get(name) {\n  return trackedValues[name].value;\n}\n\nexport function set(name, newValue) {\n  const trackedValue = trackedValues[name];\n  if (!trackedValue) {\n    throw new Error(`no such track value: ${name}`);\n  }\n  trackedValue.value = newValue;\n  const fns = [...trackedValue.subscriptions.keys()];\n  for (const fn of fns) {\n    fn(newValue, name);\n  }\n}\n\nexport function subscribe(name, fn) {\n  const trackedValue = getValueOrMakeNew(name);\n  trackedValue.subscriptions.add(fn);\n}\n\nexport function unsubscribe(name, fn) {\n  const trackedValue = getValueOrMakeNew(name);\n  trackedValue.subscriptions.delete(fn);\n}\n\nconst newTestData = {\n  \"name\": \"My jsGist\",\n  \"settings\": {},\n  \"files\": [\n    {\n      name: \"index.html\",\n      content: \"\",\n    },\n    {\n      name: \"index.css\",\n      content: \"\",\n    },\n    {\n      name: \"index.js\",\n      content: \"\",\n    },\n  ],\n};\nexport function getNewData() {\n  return JSON.parse(JSON.stringify(newTestData));\n}\nexport function getBlankData() {\n  const url = `${window.location.origin}/resources/images/logo.svg`;\n  return JSON.parse(JSON.stringify({\n    \"name\": \"jsGist\",\n    \"settings\": {},\n    \"files\": [\n      {\n        \"name\": \"index.html\",\n        \"content\": ``,\n      },\n      {\n        \"name\": \"index.css\",\n        \"content\": `\n          html, body {\n            margin: 0;\n            width: 100%;\n            height: 100%;\n            background-image: url(${url});\n            background-size: contain contain;\n            background-position: center center;\n            background-repeat: no-repeat no-repeat;\n          }\n          @media (prefers-color-scheme: dark) {\n            html {\n              background: #222;\n            }\n          }\n        `,\n      },\n      {\n        \"name\": \"index.js\",\n        \"content\": \"\",\n      }\n    ]\n  }));\n}\n\nlet data;\nexport function getData() {\n  return data;\n}\n\nexport const dataVersionKey = 'dataVersion';\nexport const updateVersionKey = 'updateVersion';\nexport const filesVersionKey = 'filesVersion';\n\nadd(dataVersionKey, 0);   // any data changes (when an item in the data is change)\nadd(updateVersionKey, 0);  // all data changes (when the entire data objects replaced with new data)\nadd(filesVersionKey, 0);  // files added or removed or the main name is changed\n\nconst incVersion = key => set(key, get(key) + 1);\nconst incDataVersion = _ => incVersion(dataVersionKey);\nconst incFilesVersion = _ => incVersion(filesVersionKey);\nconst incUpdateVersion = _ => {\n  incVersion(updateVersionKey);\n  incDataVersion();\n  incFilesVersion();\n};\n\nfunction getUniqueName(basename) {\n  const filenames = new Set(data.files.map(f => f.name));\n  for (let count = data.files.length + 1; ; ++count) {\n    const name = `${basename}${count}`;\n    if (!filenames.has(name)) {\n      return name;\n    }\n  }\n}\n\nexport function addFile(name = \"\", content = \"\") {\n  name = name || getUniqueName('unnamed');\n  data.files.push({\n    name,\n    content,\n  });\n  incDataVersion();\n  incFilesVersion();\n}\n\nexport function setName(name) {\n  data.name = name;\n  incDataVersion();\n  incFilesVersion();\n}\n\nexport function setFileName(ndx, newName) {\n  data.files[ndx].name = newName;\n  incDataVersion();\n}\n\nexport function setFileContent(ndx, content) {\n  data.files[ndx].content = content;\n  incDataVersion();\n}\n\nexport function setFileType(ndx, type) {\n  data.files[ndx].type = type;\n  incDataVersion();\n}\n\nexport function deleteFile(ndx) {\n  data.files.splice(ndx, 1);\n  incDataVersion();\n  incFilesVersion();\n}\n\nexport function validate(data) {\n  if (!validator(data)) {\n    throw new Error(`data not valid:\\n${validator.errors.map(e => `${e.message}: ${e.dataPath}`)}`);\n  }\n}\n\nexport function setData(newData) {\n  validate(newData);\n  data = newData;\n  if (isDevelopment) {\n    window.d = data;\n  }\n  incUpdateVersion();\n}\n\nsetData(isDevelopment ? {\n  \"name\": \"ThreeJSFundamentals Scenegraph Tank\",\n  \"settings\": {},\n  \"files\": [\n    {\n      \"name\": \"index.html\",\n      \"content\": \"<canvas id=\\\"c\\\"></canvas>\\n<div id=\\\"info\\\"></div>\",\n    },\n    {\n      \"name\": \"index.css\",\n      \"content\": \"body {\\n  margin: 0;\\n}\\n#c {\\n  width: 100vw;\\n  height: 100vh;\\n  display: block;\\n}\\n#info { \\n  position: absolute; \\n  left: 1em; \\n  top: 1em; \\n  background: rgba(0,0,0,.8); \\n  padding: .5em;\\n  color: white;\\n  font-family: monospace;\\n}\",\n    },\n    {\n      \"name\": \"index.js\",\n      \"content\": \"import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r119/build/three.module.js';\\n\\nfunction main() {\\n  const canvas = document.querySelector('#c');\\n  const renderer = new THREE.WebGLRenderer({canvas: canvas});\\n  renderer.setClearColor(0xAAAAAA);\\n  renderer.shadowMap.enabled = true;\\n\\n  function makeCamera(fov = 40) {\\n    const aspect = 2;  // the canvas default\\n    const zNear = 0.1;\\n    const zFar = 1000;\\n    return new THREE.PerspectiveCamera(fov, aspect, zNear, zFar);\\n  }\\n  const camera = makeCamera();\\n  camera.position.set(8, 4, 10).multiplyScalar(3);\\n  camera.lookAt(0, 0, 0);\\n\\n  const scene = new THREE.Scene();\\n\\n  {\\n    const light = new THREE.DirectionalLight(0xffffff, 1);\\n    light.position.set(0, 20, 0);\\n    scene.add(light);\\n    light.castShadow = true;\\n    light.shadow.mapSize.width = 2048;\\n    light.shadow.mapSize.height = 2048;\\n\\n    const d = 50;\\n    light.shadow.camera.left = -d;\\n    light.shadow.camera.right = d;\\n    light.shadow.camera.top = d;\\n    light.shadow.camera.bottom = -d;\\n    light.shadow.camera.near = 1;\\n    light.shadow.camera.far = 50;\\n    light.shadow.bias = 0.001;\\n  }\\n\\n  {\\n    const light = new THREE.DirectionalLight(0xffffff, 1);\\n    light.position.set(1, 2, 4);\\n    scene.add(light);\\n  }\\n\\n  const groundGeometry = new THREE.PlaneBufferGeometry(50, 50);\\n  const groundMaterial = new THREE.MeshPhongMaterial({color: 0xCC8866});\\n  const groundMesh = new THREE.Mesh(groundGeometry, groundMaterial);\\n  groundMesh.rotation.x = Math.PI * -.5;\\n  groundMesh.receiveShadow = true;\\n  scene.add(groundMesh);\\n\\n  const carWidth = 4;\\n  const carHeight = 1;\\n  const carLength = 8;\\n\\n  const tank = new THREE.Object3D();\\n  scene.add(tank);\\n\\n  const bodyGeometry = new THREE.BoxBufferGeometry(carWidth, carHeight, carLength);\\n  const bodyMaterial = new THREE.MeshPhongMaterial({color: 0x6688AA});\\n  const bodyMesh = new THREE.Mesh(bodyGeometry, bodyMaterial);\\n  bodyMesh.position.y = 1.4;\\n  bodyMesh.castShadow = true;\\n  tank.add(bodyMesh);\\n\\n  const tankCameraFov = 75;\\n  const tankCamera = makeCamera(tankCameraFov);\\n  tankCamera.position.y = 3;\\n  tankCamera.position.z = -6;\\n  tankCamera.rotation.y = Math.PI;\\n  bodyMesh.add(tankCamera);\\n\\n  const wheelRadius = 1;\\n  const wheelThickness = .5;\\n  const wheelSegments = 6;\\n  const wheelGeometry = new THREE.CylinderBufferGeometry(\\n      wheelRadius,     // top radius\\n      wheelRadius,     // bottom radius\\n      wheelThickness,  // height of cylinder\\n      wheelSegments);\\n  const wheelMaterial = new THREE.MeshPhongMaterial({color: 0x888888});\\n  const wheelPositions = [\\n    [-carWidth / 2 - wheelThickness / 2, -carHeight / 2,  carLength / 3],\\n    [ carWidth / 2 + wheelThickness / 2, -carHeight / 2,  carLength / 3],\\n    [-carWidth / 2 - wheelThickness / 2, -carHeight / 2, 0],\\n    [ carWidth / 2 + wheelThickness / 2, -carHeight / 2, 0],\\n    [-carWidth / 2 - wheelThickness / 2, -carHeight / 2, -carLength / 3],\\n    [ carWidth / 2 + wheelThickness / 2, -carHeight / 2, -carLength / 3],\\n  ];\\n  const wheelMeshes = wheelPositions.map((position) => {\\n    const mesh = new THREE.Mesh(wheelGeometry, wheelMaterial);\\n    mesh.position.set(...position);\\n    mesh.rotation.z = Math.PI * .5;\\n    mesh.castShadow = true;\\n    bodyMesh.add(mesh);\\n    return mesh;\\n  });\\n\\n  const domeRadius = 2;\\n  const domeWidthSubdivisions = 12;\\n  const domeHeightSubdivisions = 12;\\n  const domePhiStart = 0;\\n  const domePhiEnd = Math.PI * 2;\\n  const domeThetaStart = 0;\\n  const domeThetaEnd = Math.PI * .5;\\n  const domeGeometry = new THREE.SphereBufferGeometry(\\n    domeRadius, domeWidthSubdivisions, domeHeightSubdivisions,\\n    domePhiStart, domePhiEnd, domeThetaStart, domeThetaEnd);\\n  const domeMesh = new THREE.Mesh(domeGeometry, bodyMaterial);\\n  domeMesh.castShadow = true;\\n  bodyMesh.add(domeMesh);\\n  domeMesh.position.y = .5;\\n\\n  const turretWidth = .1;\\n  const turretHeight = .1;\\n  const turretLength = carLength * .75 * .2;\\n  const turretGeometry = new THREE.BoxBufferGeometry(\\n      turretWidth, turretHeight, turretLength);\\n  const turretMesh = new THREE.Mesh(turretGeometry, bodyMaterial);\\n  const turretPivot = new THREE.Object3D();\\n  turretMesh.castShadow = true;\\n  turretPivot.scale.set(5, 5, 5);\\n  turretPivot.position.y = .5;\\n  turretMesh.position.z = turretLength * .5;\\n  turretPivot.add(turretMesh);\\n  bodyMesh.add(turretPivot);\\n\\n  const turretCamera = makeCamera();\\n  turretCamera.position.y = .75 * .2;\\n  turretMesh.add(turretCamera);\\n\\n  const targetGeometry = new THREE.SphereBufferGeometry(.5, 6, 3);\\n  const targetMaterial = new THREE.MeshPhongMaterial({color: 0x00FF00, flatShading: true});\\n  const targetMesh = new THREE.Mesh(targetGeometry, targetMaterial);\\n  const targetOrbit = new THREE.Object3D();\\n  const targetElevation = new THREE.Object3D();\\n  const targetBob = new THREE.Object3D();\\n  targetMesh.castShadow = true;\\n  scene.add(targetOrbit);\\n  targetOrbit.add(targetElevation);\\n  targetElevation.position.z = carLength * 2;\\n  targetElevation.position.y = 8;\\n  targetElevation.add(targetBob);\\n  targetBob.add(targetMesh);\\n\\n  const targetCamera = makeCamera();\\n  const targetCameraPivot = new THREE.Object3D();\\n  targetCamera.position.y = 1;\\n  targetCamera.position.z = -2;\\n  targetCamera.rotation.y = Math.PI;\\n  targetBob.add(targetCameraPivot);\\n  targetCameraPivot.add(targetCamera);\\n\\n  // Create a sine-like wave\\n  const curve = new THREE.SplineCurve( [\\n    new THREE.Vector2( -10, 0 ),\\n    new THREE.Vector2( -5, 5 ),\\n    new THREE.Vector2( 0, 0 ),\\n    new THREE.Vector2( 5, -5 ),\\n    new THREE.Vector2( 10, 0 ),\\n    new THREE.Vector2( 5, 10 ),\\n    new THREE.Vector2( -5, 10 ),\\n    new THREE.Vector2( -10, -10 ),\\n    new THREE.Vector2( -15, -8 ),\\n    new THREE.Vector2( -10, 0 ),\\n  ] );\\n\\n  const points = curve.getPoints( 50 );\\n  const geometry = new THREE.BufferGeometry().setFromPoints( points );\\n  const material = new THREE.LineBasicMaterial( { color : 0xff0000 } );\\n  const splineObject = new THREE.Line( geometry, material );\\n  splineObject.rotation.x = Math.PI * .5;\\n  splineObject.position.y = 0.05;\\n  scene.add(splineObject);\\n\\n  function resizeRendererToDisplaySize(renderer) {\\n    const canvas = renderer.domElement;\\n    const width = canvas.clientWidth;\\n    const height = canvas.clientHeight;\\n    const needResize = canvas.width !== width || canvas.height !== height;\\n    if (needResize) {\\n      renderer.setSize(width, height, false);\\n    }\\n    return needResize;\\n  }\\n\\n  const targetPosition = new THREE.Vector3();\\n  const tankPosition = new THREE.Vector2();\\n  const tankTarget = new THREE.Vector2();\\n\\n  const cameras = [\\n    { cam: camera, desc: 'detached camera', },\\n    { cam: turretCamera, desc: 'on turret looking at target', },\\n    { cam: targetCamera, desc: 'near target looking at tank', },\\n    { cam: tankCamera, desc: 'above back of tank', },\\n  ];\\n\\n  const infoElem = document.querySelector('#info');\\n\\n  function render(time) {\\n    time *= 0.001;\\n\\n    if (resizeRendererToDisplaySize(renderer)) {\\n      const canvas = renderer.domElement;\\n      cameras.forEach((cameraInfo) => {\\n        const camera = cameraInfo.cam;\\n        camera.aspect = canvas.clientWidth / canvas.clientHeight;\\n        camera.updateProjectionMatrix();\\n      });\\n    }\\n\\n    // move target\\n    targetOrbit.rotation.y = time * .27;\\n    targetBob.position.y = Math.sin(time * 2) * 4;\\n    targetMesh.rotation.x = time * 7;\\n    targetMesh.rotation.y = time * 13;\\n    targetMaterial.emissive.setHSL(time * 10 % 1, 1, .25);\\n    targetMaterial.color.setHSL(time * 10 % 1, 1, .25);\\n\\n    // move tank\\n    const tankTime = time * .05;\\n    curve.getPointAt(tankTime % 1, tankPosition);\\n    curve.getPointAt((tankTime + 0.01) % 1, tankTarget);\\n    tank.position.set(tankPosition.x, 0, tankPosition.y);\\n    tank.lookAt(tankTarget.x, 0, tankTarget.y);\\n\\n    // face turret at target\\n    targetMesh.getWorldPosition(targetPosition);\\n    turretPivot.lookAt(targetPosition);\\n\\n    // make the turretCamera look at target\\n    turretCamera.lookAt(targetPosition);\\n\\n    // make the targetCameraPivot look at the at the tank\\n    tank.getWorldPosition(targetPosition);\\n    targetCameraPivot.lookAt(targetPosition);\\n\\n    wheelMeshes.forEach((obj) => {\\n      obj.rotation.x = time * 3;\\n    });\\n\\n    const camera = cameras[time * .25 % cameras.length | 0];\\n    infoElem.textContent = camera.desc;\\n\\n    renderer.render(scene, camera.cam);\\n\\n    requestAnimationFrame(render);\\n  }\\n\\n  requestAnimationFrame(render);\\n}\\n\\nmain();\\n\",\n    }\n  ]\n} : getNewData());\n","const camelCaseRE = /([a-z])([A-Z])/g;\nconst toDash = (_, left, right) => `${left}-${right}`;\nconst camelCaseToDash = s => s.replace(camelCaseRE, toDash).toLowerCase();\n\nexport function classNames(...args) {\n  const names = [];\n  for (const arg of args) {\n    if (typeof arg === 'string') {\n      names.push(arg);\n    } else {\n      for (const [key, value] of Object.entries(arg)) {\n        if (value) {\n          names.push(camelCaseToDash(key));\n        }\n      }\n    }\n  }\n  return names.join(' ');\n}","import React from 'react';\n//import {Resizable} from 're-resizable';\nimport Code from './Code.js';\nimport {classNames} from '../libs/css-utils.js';\n\nexport default function CodeArea(props) {\n  const {\n    value,\n    hackKey,\n    heading,\n    extra = [],\n    options = {},\n    onValueChange,\n    registerAPI,\n  } = props;\n  return (\n    <div className=\"code-area\" style={props.style}>\n        <div className=\"expander\">\n          {heading}\n        </div>\n        <div className={classNames(\"hidee\")}>\n            <Code\n              hackKey={hackKey}\n              value={value}\n              options={options}\n              onValueChange={onValueChange}\n              registerAPI={registerAPI}\n            />\n          {extra}\n        </div>\n    </div>\n  );\n};\n","import {storageManager} from '../globals.js';\nimport * as model from './model.js';\n\nconst settingsKey = 'ui-settings';\n\nlet initialized = false;\nlet settings;\n\nfunction init() {\n  if (initialized) {\n    return;\n  }\n  initialized = true;\n  try {\n    settings = JSON.parse(storageManager.get(settingsKey, true));\n    if (!settings) {\n      throw new Error('no settings');\n    }\n  } catch (e) {\n    settings = {\n      layout: (window.screen.width < 540 || window.screen.height < 540) ? 3 : 0,\n    };\n  }\n}\n\nmodel.add('settings', settings);\n\nexport function set(name, value) {\n  settings[name] = value;\n  const json = JSON.stringify(settings);\n  storageManager.set(settingsKey, json, true);\n  model.set('settings', settings);\n}\n\nexport function get() {\n  init();\n  return settings;\n}\n\nexport function subscribe(fn) {\n  model.subscribe('settings', fn);\n}\n\nexport function unsubscribe(fn) {\n  model.unsubscribe('settings', fn);\n}\n","import mime from 'mime-types';\nimport React from 'react';\n// import EditLine from './EditLine.js';\nimport CodeArea from './CodeArea.js';\n\nexport default class File extends React.Component {\n  componentDidMount() {\n    const {register} = this.props;\n    register(this, {\n      goToLine: (data) => {\n        const {title} = this.props;\n        if (data.section === title) {\n          this.codeAPI.goToLine(data.lineNo, data.colNo);\n          return true;\n        }\n      },\n      refresh: _ => this.codeAPI.refresh(),\n      focus: _ => this.codeAPI.focus(),\n    });\n  }\n  componentWillUnmount() {\n    const {unregister} = this.props;\n    unregister(this);\n  }\n  handleRegisterAPI = (api) => {\n    this.codeAPI = api;\n  }\n  render() {\n    const props = this.props;\n    const {title, hackKey} = props;\n    const heading = (\n      <div style={{width: '100%'}}>{title}</div>\n    );\n    const mimeType = mime.lookup(title) || (title.toLowerCase() === 'javascript' ? 'application/javascript' : 'application/octet-stream');\n    const options = {\n      ...props.options,\n      editor: {\n        ...(props.options?.editor && props.options.editor),\n        mode: mimeType,\n      },\n    };\n    return (\n      <CodeArea\n        key={hackKey}\n        {...props}\n        options={options}\n        heading={heading}\n        registerAPI={this.handleRegisterAPI}\n      />\n    );\n  }\n}\n\n/*\nexport default function TestArea(props) {\n  const {desc, title, onTitleChange, hackKey} = props;\n  const heading = (\n    <div>{title}</div>\n    <EditLine\n      placeholder={desc}\n      value={title}\n      onChange={onTitleChange}\n    />\n  );\n\n  return (\n    <CodeArea key={hackKey} {...props} heading={heading} />\n  );\n}\n*/\n","import Ajv from 'ajv';\nimport React from 'react';\nimport Split, {moveGuttersComputeNewSizes} from 'react-split-it';\n\nimport * as model from '../libs/model.js';\nimport File from './File.js';\nimport * as uiModel from '../libs/ui-model.js';\n\nconst makeId = _ => `${Date.now()}+${Math.random()}`;\n\nconst uiStateSchema = {\n  \"type\": \"object\",\n  \"properties\": {\n    \"sizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}},\n  },\n  \"required\": [\"sizes\"],\n};\nconst ajv = new Ajv() // options can be passed, e.g. {allErrors: true}\nconst uiStateValidator = ajv.compile(uiStateSchema);\n\nexport default class Files extends React.Component {\n  constructor(props) {\n    super(props);\n    this.files = new Map();\n    this.fileToKeyMap = new Map();\n    this.kUIStateKey = `${props.uiStateKey}-files`;\n    const state = uiModel.get()[this.kUIStateKey];\n    this.state = uiStateValidator(state) ? state : {\n      sizes: [],\n    };\n    if (this.state.sizes.length !== props.data.files.length) {\n      this.state.sizes = props.data.files.map((_, i) => 1 / props.data.files.length);\n    }\n  }\n  onSetSizes = (sizes) => {\n    this.setState({sizes});\n    uiModel.set(this.kUIStateKey, this.state);\n  }\n  handleRegister = (file, api) => {\n    this.files.set(file, api);\n  }\n  handleUnregister = (file) => {\n    this.files.delete(file);\n  }\n  getFileKey(test) {\n    let key = this.fileToKeyMap.get(test);\n    if (!key) {\n      key = makeId();\n      this.fileToKeyMap.set(test, key);\n    }\n    return key;\n  }\n  componentDidMount() {\n    const {registerAPI} = this.props;\n    registerAPI({\n      goToLine: (data) => {\n        this.files.forEach(api => {\n          api.goToLine(data);\n        });\n      },\n    });\n  }\n  render() {\n    const {hackKey, data, extra, direction} = this.props;\n    const {sizes} = this.state;\n    return (\n      <div className=\"codes\">\n        <Split\n          direction={direction}\n          minSize={0}\n          sizes={sizes}\n          onSetSizes={this.onSetSizes}\n          computeNewSizesFn={moveGuttersComputeNewSizes}\n        >\n        {\n          data.files.map((file, ndx) => {\n            return (\n              <File\n                key={`ca${this.getFileKey(file)}`}\n                hackKey={hackKey}\n                desc=\"filename\"\n                title={file.name}\n                value={file.content}\n                onTitleChange={name => model.setFileName(ndx, name)}\n                onValueChange={value => model.setFileContent(ndx, value)}\n                register={this.handleRegister}\n                unregister={this.handleUnregister}\n                extra={extra}\n              />\n            );\n          })\n        }\n        </Split>\n      </div>\n    );\n  }\n}\n\n//         {/*<button onClick={() => model.addFile()}>+</button>*/}\n","import React from 'react';\n\nimport {classNames} from '../libs/css-utils';\nimport ServiceContext from '../ServiceContext.js';\n\nfunction basename(url) {\n  const ndx = url.lastIndexOf('/');\n  return ndx >= 0 ? url.substr(ndx + 1) : url;\n}\n\nfunction isMsgSame(oldMsg, newMsg) {\n  if (!!oldMsg !== !!newMsg) {\n    return false;\n  }\n  const keys = Object.keys(oldMsg).filter(key => key !== 'count');\n  if (keys.length !== Object.keys(newMsg).length) {\n    return false;\n  }\n  for (const key of keys) {\n    if (oldMsg[key] !== newMsg[key]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport class LogManager extends EventTarget {\n  constructor() {\n    super();\n    this._msgs = [];\n  }\n  _notify() {\n    this.dispatchEvent(new Event('change'));\n  }\n  clear = () => {\n    this._msgs = [];\n    this._notify();\n  }\n  _addMsg = (data) => {\n    const lastData = this._msgs[this._msgs.length - 1];\n    if (isMsgSame(lastData, data)) {\n      lastData.count = (lastData.count || 0) + 1;\n    } else {\n      this._msgs.push(data);\n    }\n  }\n  addMsg = (data) => {\n    this._addMsg(data);\n    this._notify();\n  }\n  addMsgs = (msgs) => {\n    for (const {type, data} of msgs) {\n      switch (type) {\n        case 'jsError':\n          this._addMsg({...data, type: 'error', showStack: true});\n          break;\n        case 'jsUnhandledRejection':\n          this._addMsg({...data, type: 'error', showStack: true});\n          break;\n        default:\n          this._addMsg(data);\n          break;\n      }\n    }\n    this._notify();\n  }\n  getMsgs() {\n    return this._msgs\n  }\n}\n\nexport default class Log extends React.Component {\n  constructor(props) {\n    super(props);\n    this.logMessagesRef = React.createRef();\n  }\n  handleChange = () => {\n    this.forceUpdate();\n  }\n  componentDidMount() {\n    const {logManager} = this.context;\n    logManager.addEventListener('change', this.handleChange);\n  }\n  componentWillUnmount() {\n    const {logManager} = this.context;\n    logManager.removeEventListener('change', this.handleChange);\n  }\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    if (snapshot !== null) {\n      // if we were at the bottom of the log then\n      // stay at the bottom of the log\n      if (snapshot < 1) {\n        const elem = this.logMessagesRef.current;\n        elem.scrollTop = elem.scrollHeight - elem.parentElement.clientHeight;\n      }\n    }\n  }\n  getSnapshotBeforeUpdate(prevProps, prevState) {\n    const elem = this.logMessagesRef.current;\n    return elem.scrollHeight - (elem.scrollTop + elem.parentElement.clientHeight);\n  }\n  render() {\n    const {onGoToLine} = this.props;\n    const {logManager} = this.context;\n    return (\n      <div className=\"logger\">\n        <div className=\"log-messages layout-scrollbar\" ref={this.logMessagesRef}>\n          { logManager.getMsgs().map((msg, ndx) => {\n              const tooltip = !msg.section;\n              return (\n                <div className={classNames('log-line',{[msg.type]: true})} key={`l${ndx}`}>\n                  <div className={msg.count ? \"count\" : \"no-count\"}>{msg.count ? msg.count : ''}</div>\n                  <div className=\"msg\">\n                    {msg.msg}\n                    <span>&nbsp;</span> {/* this is to prevent auto-selection to the next element when double clicking */}\n                    <div\n                      className={classNames('file', {tooltip, fileLink: msg.section})}\n                      onClick={() => onGoToLine(msg)}\n                      data-tooltip={`${msg.section || msg.url}:${msg.lineNo}`}\n                    >\n                      {msg.section || basename(msg.url || '')}:{msg.lineNo}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n        </div>\n      </div>\n    );\n  }\n}\n\nLog.contextType = ServiceContext;","import React from 'react';\n\nimport {isDevelopment} from '../libs/flags.js';\nimport ServiceContext from '../ServiceContext.js';\nimport {createURL} from '../libs/url.js';\nimport * as winMsgMgr from '../libs/WindowMessageManager';\n\nexport default class Runner extends React.Component {\n  constructor(props) {\n    super(props);\n    this.runnerRef = React.createRef();\n  }\n  handleJSLog = (data) => {\n    const {logManager} = this.context;\n    logManager.addMsg(data);\n  }\n  handleJSError = (data) => {\n    const {logManager} = this.context;\n    logManager.addMsg({...data, type: 'error', showStack: true});\n  }\n  handleJSUnhandledRejection = (data) => {\n    const {logManager} = this.context;\n    logManager.addMsg({...data, type: 'error', showStack: true});\n  }\n  handleInfoMessages = (data) => {\n    const {logManager} = this.context;\n    logManager.addMsgs(data);\n  }\n  handleGimmeDaCodez = () => {\n    this.iframe.contentWindow.postMessage({\n      type: 'run',\n      data: this.data,\n    }, \"*\");\n  }\n  componentDidMount() {\n    const {registerAPI} = this.props;\n    registerAPI({\n      run: (data, blank) => {\n        this.data = data;\n        this.removeIFrame();\n        const iframe = document.createElement('iframe');\n        this.iframe = iframe;\n        iframe.src = isDevelopment\n            ? createURL(`http://${window.location.hostname}:8081/runner-03.html`, {url: `http://${window.location.hostname}:8080/jsgist-runner.js`})\n            : createURL('https://jsgistrunner.devcomments.org/runner-03.html', {url: 'https://jsgist.org/jsgist-runner.js'});\n        if (blank) {\n          iframe.style.background = 'none';\n        }\n        this.runnerRef.current.appendChild(iframe);\n      },\n    })\n    winMsgMgr.on('gimmeDaCodez', null, this.handleGimmeDaCodez);\n    winMsgMgr.on('jsLog', null, this.handleJSLog);\n    winMsgMgr.on('jsError', null, this.handleJSError);\n    winMsgMgr.on('jsUnhandledRejection', null, this.handleJSUnhandledRejection);\n    winMsgMgr.on('infoMessages', null, this.handleInfoMessages);\n  }\n  removeIFrame() {\n    if (this.iframe) {\n      this.iframe.remove();\n      this.iframe.src = 'about:blank';\n      this.iframe = undefined;\n    }\n  }\n  componentWillUnmount() {\n    this.removeIFrame();\n    winMsgMgr.remove('gimmeDaCodez', null, this.handleGimmeDaCodez);\n    winMsgMgr.remove('jsLog', null, this.handleJSLog);\n    winMsgMgr.remove('jsError', null, this.handleJSError);\n    winMsgMgr.remove('jsUnhandledRejection', null, this.handleJSUnhandledRejection);\n    winMsgMgr.remove('infoMessages', null, this.handleInfoMessages);\n  }\n  handleMessage = (e) => {\n    const {type, data} =  e.data;\n    const fn = this.handlers[type];\n    if (fn) {\n      fn(data);\n    }\n  }\n  render() {\n    return (\n      <div className=\"runner\" ref={this.runnerRef}></div>\n    )\n  }\n}\n\nRunner.contextType = ServiceContext;","import Ajv from 'ajv';\nimport React from 'react';\nimport Split from 'react-split-it';\n\nimport Files from './Files.js';\nimport Log from './Log.js';\nimport Runner from './Runner.js';\nimport * as uiModel from '../libs/ui-model.js';\n\nconst kUIStateKey = 'layout3Vertical';\n\nconst uiStateSchema = {\n  \"type\": \"object\",\n  \"properties\": {\n    \"hSizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 2},\n    \"vSizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 2},\n  },\n  \"required\": [\"hSizes\", \"vSizes\"],\n};\nconst ajv = new Ajv() // options can be passed, e.g. {allErrors: true}\nconst uiStateValidator = ajv.compile(uiStateSchema);\n\nexport default class Layout3Vertical extends React.Component {\n  constructor(props) {\n    super(props);\n    const state = uiModel.get()[kUIStateKey];\n    this.state = uiStateValidator(state) ? state : {\n      hSizes: [0.5, 0.5],\n      vSizes: [0.9, 0.1],\n    };\n  }\n  onSetVSizes = (sizes) => {\n    this.setState({vSizes: sizes});\n    uiModel.set(kUIStateKey, this.state);\n  }\n  onSetHSizes = (sizes) => {\n    this.setState({hSizes: sizes});\n    uiModel.set(kUIStateKey, this.state);\n  }\n  registerFilesAPI = (api) => {\n    this.filesAPI = api;\n  }\n  handleGoToLine = (data) => {\n    this.filesAPI.goToLine(data);\n  }\n  render() {\n    const {hackKey, data, registerRunnerAPI} = this.props;\n    const {vSizes, hSizes} = this.state;\n    return (\n      <Split direction=\"horizontal\" minSize={0} sizes={hSizes} onSetSizes={this.onSetHSizes}>\n        <div className=\"left\">\n          <Files\n            direction=\"vertical\"\n            uiStateKey={kUIStateKey}\n            data={data}\n            hackKey={hackKey}\n            registerAPI={this.registerFilesAPI}\n          />\n        </div>\n        <div className=\"right\">\n          <Split direction=\"vertical\" minSize={0} sizes={vSizes} onSetSizes={this.onSetVSizes}>\n            <Runner registerAPI={registerRunnerAPI} />\n            <Log onGoToLine={this.handleGoToLine} />\n          </Split>\n        </div>\n      </Split>\n    );\n  };\n}","import Ajv from 'ajv';\nimport React from 'react';\nimport Split from 'react-split-it';\n\nimport Files from './Files.js';\nimport Log from './Log.js';\nimport Runner from './Runner.js';\nimport * as uiModel from '../libs/ui-model.js';\n\nconst kUIStateKey = 'layout3Horizontal';\n\nconst uiStateSchema = {\n  \"type\": \"object\",\n  \"properties\": {\n    \"tSizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 2},\n    \"bSizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 2},\n  },\n  \"required\": [\"tSizes\", \"bSizes\"],\n};\nconst ajv = new Ajv() // options can be passed, e.g. {allErrors: true}\nconst uiStateValidator = ajv.compile(uiStateSchema);\n\nexport default class Layout3Horizontal extends React.Component {\n  constructor(props) {\n    super(props);\n    const state = uiModel.get()[kUIStateKey];\n    this.state = uiStateValidator(state) ? state : {\n      tSizes: [0.5, 0.5],\n      bSizes: [0.9, 0.1],\n    };\n  }\n  onSetTSizes = (sizes) => {\n    this.setState({tSizes: sizes});\n    uiModel.set(kUIStateKey, this.state);\n  }\n  onSetBSizes = (sizes) => {\n    this.setState({bSizes: sizes});\n    uiModel.set(kUIStateKey, this.state);\n  }\n  registerFilesAPI = (api) => {\n    this.filesAPI = api;\n  }\n  handleGoToLine = (data) => {\n    this.filesAPI.goToLine(data);\n  }\n  render() {\n    const {hackKey, data, registerRunnerAPI} = this.props;\n    const {tSizes, bSizes} = this.state;\n    return (\n      <Split direction=\"vertical\" minSize={0} sizes={tSizes} onSetSizes={this.onSetTSizes}>\n        <div className=\"layout-3-horizontal-top\">\n          <Files uiStateKey={kUIStateKey} direction=\"horizontal\" data={data} hackKey={hackKey} registerAPI={this.registerFilesAPI} />\n        </div>\n        <div className=\"layout-3-horizontal-bottom\">\n          <Split direction=\"vertical\"  sizes={bSizes} onSetSizes={this.onSetBSizes}>\n            <Runner registerAPI={registerRunnerAPI} />\n            <Log onGoToLine={this.handleGoToLine} />\n          </Split>\n        </div>\n      </Split>\n    );\n  };\n}","export const noop = () => {};\nexport const wait = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\n\nexport function escapeTextForHTMLContent(s: string) {\n  return s.replace(/&/g, '&amp;')\n          .replace(/</g, '&lt;')\n          .replace(/>/g, '&gt;');\n}\n\nfunction findNdx(files: any, endings: string[]) {\n  // calling toLowerCase a bunch is bad but there will never be more than a few files\n  for (const ending of endings) {\n    const ndx = files.findIndex((file: any) => file.name.toLowerCase().endsWith(ending.toLowerCase()));\n    if (ndx >= 0) {\n      return ndx;\n    }\n  }\n  return -1;\n}\n\nexport function getOrFindNdx(files: any[], name: string, ...endings: string[]) {\n  const ndx = files.findIndex(f => f.name.toLowerCase() === name.toLowerCase);\n  if (ndx >= 0) {\n    return ndx;\n  }\n  return findNdx(files, endings);\n}\n\nexport function getOrFind(files: any[], ...args: string[]) {\n  const ndx = getOrFindNdx(files, '', ...args);\n  return ndx >= 0 ? files[ndx] : '';\n}\n\nconst stringify = (options: any, sep: string = ',') => Object.entries(options).map(([key, value]) => `${key}=${value}`).join(sep);\n\nexport function createPopup(url: string, config: any = {}): (Window | undefined) {\n  const width = config.width || 500;\n  const height = config.height || 500;\n  const options = {\n    width: width,\n    height: height,\n    top: window.screenY + ((window.outerHeight - height) / 2.5),\n    left: window.screenX + ((window.outerWidth - width) / 2)\n  };\n  return window.open(url, '_blank', stringify(options, ',')) || undefined;\n}","import Ajv from 'ajv';\nimport React from 'react';\nimport Split from 'react-split-it';\n\nimport File from './File.js';\nimport Log from './Log.js';\nimport * as model from '../libs/model.js';\nimport Runner from './Runner.js';\nimport * as uiModel from '../libs/ui-model.js';\nimport {getOrFindNdx} from '../libs/utils';\n\nconst kUIStateKey = 'layout2x2';\n\nconst uiStateSchema = {\n  \"type\": \"object\",\n  \"properties\": {\n    \"hSizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 2},\n    \"v1Sizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 2},\n    \"v2Sizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 2},\n  },\n  \"required\": [\"hSizes\", \"v1Sizes\", \"v2Sizes\"],\n};\nconst ajv = new Ajv() // options can be passed, e.g. {allErrors: true}\nconst uiStateValidator = ajv.compile(uiStateSchema);\n\nfunction NamedFile(props) {\n  const {data, ndx, hackKey, register, unregister} = props;\n  const file = data.files[ndx];\n  return (\n    <File\n      //key={`ca${this.getFileKey(file)}`}\n      hackKey={hackKey}\n      desc=\"filename\"\n      title={file.name}\n      value={file.content}\n      onTitleChange={name => model.setFileName(ndx, name)}\n      onValueChange={value => model.setFileContent(ndx, value)}\n      register={register}\n      unregister={unregister}\n    />\n  );\n}\n\n\nexport default class Layout2x2 extends React.Component {\n  constructor(props) {\n    super(props);\n    this.files = new Map();\n    const state = uiModel.get()[kUIStateKey];\n    this.state = uiStateValidator(state) ? state : {\n      hSizes: [0.5, 0.5],\n      v1Sizes: [0.4, 0.6],\n      v2Sizes: [0.4, 0.5, 0.1],\n    };\n  }\n  onSetHSizes = (sizes) => {\n    this.setState({hSizes: sizes});\n    uiModel.set(kUIStateKey, this.state);\n  }\n  onSetV1Sizes = (sizes) => {\n    this.setState({v1Sizes: sizes});\n    uiModel.set(kUIStateKey, this.state);\n  }\n  onSetV2Sizes = (sizes) => {\n    this.setState({v2Sizes: sizes});\n    uiModel.set(kUIStateKey, this.state);\n  }\n  handleRegister = (file, api) => {\n    this.files.set(file, api);\n  }\n  handleUnregister = (file) => {\n    this.files.delete(file);\n  }\n  handleGoToLine = (data) => {\n    this.files.forEach(api => {\n      api.goToLine(data);\n    });\n  }\n  render() {\n    const {hackKey, data, registerRunnerAPI} = this.props;\n    const files = data.files;\n    const mainHTMLNdx = getOrFindNdx(files, 'index.html', 'html');\n    const mainJSNdx = getOrFindNdx(files, 'index.js', 'js', 'js', 'javascript');\n    const mainCSSNdx = getOrFindNdx(files, 'index.css', 'css');\n    const {hSizes, v1Sizes, v2Sizes} = this.state;\n\n    return (\n      <Split direction=\"horizontal\" minSize={0} sizes={hSizes} onSetSizes={this.onSetHSizes}>\n        <div className=\"left\">\n          <Split direction=\"vertical\" minSize={0} sizes={v1Sizes} onSetSizes={this.onSetV1Sizes}>\n            <NamedFile hackKey={hackKey} register={this.handleRegister} unregister={this.handleUnregister} data={data} ndx={mainHTMLNdx} />\n            <NamedFile hackKey={hackKey} register={this.handleRegister} unregister={this.handleUnregister} data={data} ndx={mainJSNdx} />\n          </Split>\n        </div>\n        <div className=\"right\">\n          <Split direction=\"vertical\" minSize={0} sizes={v2Sizes} onSetSizes={this.onSetV2Sizes}>\n            <NamedFile hackKey={hackKey} register={this.handleRegister} unregister={this.handleUnregister} data={data} ndx={mainCSSNdx} />\n            <Runner registerAPI={registerRunnerAPI} />\n            <Log onGoToLine={this.handleGoToLine} />\n          </Split>\n        </div>\n      </Split>\n    );\n  };\n}","import Ajv from 'ajv';\nimport React from 'react';\nimport Split from 'react-split-it';\n\nimport File from './File.js';\nimport Log from './Log.js';\nimport * as model from '../libs/model.js';\nimport Runner from './Runner.js';\nimport * as uiModel from '../libs/ui-model.js';\n\nconst kUIStateKey = 'layoutTabbed';\nconst uiStateSchema = {\n  \"type\": \"object\",\n  \"properties\": {\n    \"showResult\": { \"type\": \"boolean\" },\n    \"showLog\": { \"type\": \"boolean\" },\n    \"currentNdx\": { \"type\": \"integer\" },\n    \"sizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 3 },\n    \"lastSizes:\": { \"type\": \"array\", \"items\": {\"type\": \"number\"}, \"minItems\": 3 },\n  },\n  \"required\": [\"sizes\", \"lastSizes\", \"showResult\", \"showLog\", \"currentNdx\"],\n};\nconst ajv = new Ajv() // options can be passed, e.g. {allErrors: true}\nconst uiStateValidator = ajv.compile(uiStateSchema);\n\nconst makeId = _ => `${Date.now()}-${Math.random()}`;\n\nfunction fixSizes(sizes, lastSizes, ndx, show) {\n  if (show) {\n    // we're adding a size back in.\n    const oldSize = lastSizes[ndx];\n    const availableSpace = 1 - oldSize;\n    const s = sizes.filter((_, i) => ndx !== i);\n    const len = s.reduce((sum, size) => sum + size, 0);\n    const newSizes = s.map(size => size / len * availableSpace);\n    newSizes.splice(ndx, 0, oldSize);\n    return newSizes;\n  } else {\n    // we're removing a size\n    const s = sizes.map((size, i) => ndx === i ? 0 : size);\n    const len = s.reduce((sum, size) => sum + size, 0);\n    const newSizes = s.map(size => size / len);\n    return newSizes;\n  }\n}\n\nexport default class Layout3Horizontal extends React.Component {\n  constructor(props) {\n    super(props);\n    const state = uiModel.get()[kUIStateKey];\n    this.state = uiStateValidator(state) ? state : {\n      showResult: true,\n      showLog: true,\n      currentNdx: 2,\n      sizes: [0.45, 0.45, 0.1],\n      lastSizes: [0.45, 0.45, 0.1],\n    };\n    this.files = new Map();\n    this.fileToKeyMap = new Map();\n  }\n  handleRegister = (file, api) => {\n    this.files.set(file, api);\n  }\n  handleUnregister = (file) => {\n    this.files.delete(file);\n  }\n  getFileKey(test) {\n    let key = this.fileToKeyMap.get(test);\n    if (!key) {\n      key = makeId();\n      this.fileToKeyMap.set(test, key);\n    }\n    return key;\n  }\n  setSizes = (sizes) => {\n    const lastSizes = this.state.lastSizes.slice()\n    if (this.state.currentNdx >= 0) { lastSizes[0] = sizes[0] }\n    if (this.state.showResult) { lastSizes[1] = sizes[1]; }\n    if (this.state.showLow) { lastSizes[2] = sizes[2]; }\n    this.setState({sizes, lastSizes});\n    uiModel.set(kUIStateKey, this.state);\n  }\n  handleGoToLine = (data) => {\n    // this.files is Map of File components\n    this.files.forEach((api, file) => {\n      if (api.goToLine(data)) {\n        const {files} = this.props.data;\n        // this is gross (T_T)\n        const ndx = files.findIndex(file => file.name === data.section);\n        if (ndx !== this.state.currentNdx) {\n          this.handleOnChange(ndx);\n        }\n      }\n    });\n  }\n  handleOnChange = (ndx) => {\n    const currentNdx = this.state.currentNdx === ndx ? -1 : ndx;\n    this.setState({\n      currentNdx,\n      sizes: fixSizes(this.state.sizes, this.state.lastSizes, 0, currentNdx >= 0),\n    });\n    uiModel.set(kUIStateKey, this.state);\n  }\n  toggleShowLog = () => {\n    const showLog = !this.state.showLog;\n    this.setState({\n      showLog,\n      sizes: fixSizes(this.state.sizes, this.state.lastSizes, 2, showLog),\n    });\n    uiModel.set(kUIStateKey, this.state);\n  }\n  toggleShowResult = () => {\n    const showResult = !this.state.showResult;\n    this.setState({\n      showResult,\n      sizes: fixSizes(this.state.sizes, this.state.lastSizes, 1, showResult),\n    });\n    uiModel.set(kUIStateKey, this.state);\n  }\n  componentDidUpdate() {\n    if (this.previousNdx !== this.state.currentNdx) {\n      this.previousNdx = this.state.currentNdx;\n      this.files.forEach(api => {\n        api.refresh();\n        api.focus();\n      });\n    }\n  }\n  render() {\n    const {hackKey, data, registerRunnerAPI} = this.props;\n    const {showResult, showLog, sizes, currentNdx} = this.state;\n    const resultStyle = {...(!showResult && {display: 'none'})}\n    const logStyle = {...(!showLog && {display: 'none'})}\n    return (\n      <div className=\"layout-tabbed\">\n        <div className=\"layout-tabbed-top\">\n          <div className=\"tab-tabs\">\n            {\n              data.files.map((file, ndx) => {\n                const key = `ca${this.getFileKey(file)}`;\n                return (\n                  <React.Fragment key={key}>\n                    <input\n                      type=\"radio\"\n                      name=\"tabbed-files\"\n                      id={key}\n                      checked={ndx === currentNdx}\n                      onClick={_ => this.handleOnChange(ndx)}\n                      onChange={_ => _} /* this is to shut up react */\n                    />\n                    <label htmlFor={key}>{file.name}</label>\n                  </React.Fragment>\n                );\n              })\n            }\n            <input\n              type=\"checkbox\"\n              checked={showResult}\n              onChange={this.toggleShowResult}\n              id=\"result\"\n            />\n            <label htmlFor=\"result\">result</label>\n            <input\n              type=\"checkbox\"\n              checked={showLog}\n              onChange={this.toggleShowLog}\n              id=\"log\"\n            />\n            <label htmlFor=\"log\">log</label>\n          </div>\n        </div>\n        <Split direction=\"vertical\" minSize={0} sizes={sizes} onSetSizes={this.setSizes}>\n          <div className=\"tab-content\">\n          {\n            data.files.map((file, ndx) => {\n              const key = `ca${this.getFileKey(file)}`;\n              return (\n                <div key={key} style={{...(ndx !== currentNdx && {display: 'none'})}}>\n                  <File\n                    hackKey={hackKey}\n                    desc=\"filename\"\n                    title={file.name}\n                    value={file.content}\n                    onTitleChange={name => model.setFileName(ndx, name)}\n                    onValueChange={value => model.setFileContent(ndx, value)}\n                    register={this.handleRegister}\n                    unregister={this.handleUnregister}\n                  />\n                </div>\n              );\n            })\n          }\n          </div>\n          <div className=\"layout-tabbed-result\" style={resultStyle}><Runner registerAPI={registerRunnerAPI} /></div>\n          <div className=\"layout-tabbed-log\" style={logStyle}><Log onGoToLine={this.handleGoToLine} /></div>\n        </Split>\n      </div>\n    );\n  };\n}","import React from 'react';\n\nimport Layout3Vertical from './Layout3Vertical.js';\nimport Layout3Horizontal from './Layout3Horizontal.js';\nimport Layout2x2 from './Layout2x2.js';\nimport LayoutTabbed from './LayoutTabbed.js';\n\nimport * as uiModel from '../libs/ui-model.js';\n\nconst layoutModes = [\n  Layout3Vertical,\n  Layout3Horizontal,\n  Layout2x2,\n  LayoutTabbed,\n];\n\nexport default class IDE extends React.Component {\n  componentDidMount() {\n    uiModel.subscribe(this.handleChange);\n  }\n  componentWillUnmount() {\n    uiModel.unsubscribe(this.handleChange);\n  }\n  handleChange = () => {\n    this.forceUpdate();\n  }\n  render() {\n    const mode = uiModel.get().layout;\n    return React.createElement(layoutModes[mode], this.props);\n  }\n}\n\n","import Ajv from 'ajv';\nimport * as model from './model.js';\nimport {storageManager} from '../globals.js';\nconst gistsKey = 'gists';\n\nconst gistSchema = {\n  \"type\": \"object\",\n  \"properties\": {\n    \"name\": { \"type\": \"string\" },\n    \"date\": { \"type\": \"string\" },\n  },\n  \"required\": [\"name\", \"date\"],\n};\n\nconst gistsSchema = {\n  \"$schema\": \"http://json-schema.org/schema#\",\n  \"type\": \"object\",\n  \"additionalProperties\": gistSchema,\n};\nconst ajv = new Ajv() // options can be passed, e.g. {allErrors: true}\nconst gistsValidator = ajv.compile(gistsSchema);\nconst gistValidator = ajv.compile(gistSchema);\n\nfunction getStoredGists() {\n  try {\n    const gists = JSON.parse(storageManager.get(gistsKey));\n    if (!gistsValidator(gists)) {\n      storageManager.delete(gistsKey);\n      throw new Error();\n    }\n    return gists;\n  } catch(e) {\n    return {};\n  }\n}\n\nmodel.add('gists', getStoredGists());\n\n// does this need to be centralized?\nstorageManager.subscribe(gistsKey, () => {\n  model.set('gists', getStoredGists());\n});\n\nexport function addGist(id, name, date, _public) {\n  const gist = {name, date, public: _public};\n  if (!gistValidator(gist)) {\n    throw new Error(`gist not valid:\\n${gistValidator.errors.map(e => `${e.message}: ${e.dataPath}`)}`)\n  }\n  const gists = {...model.get('gists')};\n  gists[id] = gist;\n  model.set('gists', gists);\n  saveGistsToLocalStorage(gists);\n}\n\nexport function removeGist(id) {\n  const gists = {...model.get('gists')};\n  delete gists[id];\n  model.set('gists', gists);\n  saveGistsToLocalStorage(gists);\n}\n\nfunction saveGistsToLocalStorage(gists) {\n  // send to other windows\n  storageManager.set(gistsKey, JSON.stringify(gists));\n}\n\nexport function getGists() {\n  return model.get('gists');\n}\n\nexport function setGists(gists) {\n  if (!gistsValidator(gists)) {\n    throw new Error(`gists not valid:\\n${gistValidator.errors.map(e => `${e.message}: ${e.dataPath}`)}`)\n  }\n  model.set('gists', gists);\n  saveGistsToLocalStorage(gists);\n}\n\nexport function subscribe(fn) {\n  model.subscribe('gists', fn);\n}\n\nexport function unsubscribe(fn) {\n  model.unsubscribe('gists', fn);\n}\n","import React from 'react';\nimport EditLine from './EditLine.js';\nimport {classNames} from '../libs/css-utils.js';\nimport * as gists from '../libs/gists.js';\nimport ServiceContext from '../ServiceContext.js';\n\ntype Gist = {\n  name: string,\n  date: string,\n  public: boolean,\n}\n\ninterface GistIdMap {\n   [key: string]: Gist;\n} \n\ntype LoadGistState = {\n  loading: boolean,\n  gists: GistIdMap,\n  checks: Set<string>,\n  filter: string,\n};\n\nfunction gistsToSortedArray(gists: GistIdMap) {\n  return Object.entries(gists).map(([id, {name, date, public: _public}]) => {\n    return {id, name, date, public: _public};\n  }).sort((b, a) => a.date < b.date ? -1 : ((a.date > b.date) ? 1 : 0));\n}\n\nfunction matchFilter(filter: string) {\n  filter = filter.trim().toLowerCase();\n  return function(gist: Gist) {\n    const {name, date} = gist;\n    return filter === '' ||\n           name.toLowerCase().includes(filter) ||\n           date.substring(0, 10).includes(filter);\n  }\n}\n\nexport default class LoadGist extends React.Component<{}, LoadGistState> {\n  constructor (props: {}) {\n    super(props);\n    const _gists = gists.getGists();\n    this.state = {\n      loading: false,\n      gists: _gists,\n      checks: new Set(),\n      filter: '',\n    };\n  }\n  handleNewGists = (gists: GistIdMap) => {\n    this.setState({\n      gists,\n    });\n  }\n  toggleCheck = (id: string) => {\n    const checks = new Set(this.state.checks);\n    if (checks.has(id)) {\n      checks.delete(id);\n    } else {\n      checks.add(id);\n    }\n    this.setState({checks});\n  }\n  onUserStatusChange = () => {\n    this.forceUpdate();\n    const {userManager} = this.context;\n    if (userManager.getUserData()) {\n      this.loadGists();\n    }\n  }\n  componentDidMount() {\n    const {userManager} = this.context;\n    gists.subscribe(this.handleNewGists);\n    userManager.subscribe(this.onUserStatusChange);\n  }\n  componentWillUnmount() {\n    const {userManager} = this.context;\n    gists.unsubscribe(this.handleNewGists);\n    userManager.unsubscribe(this.onUserStatusChange);\n  }\n  loadGists = async() => {\n    const {addError, github} = this.context;\n    this.setState({loading: true});\n    try {\n      const gistArray = await github.getUserGists();\n      const gistsById = gistArray.reduce((gists: any[], gist: any) => {\n        gists[gist.id] = {\n          name: gist.description,\n          date: gist.updated_at,\n          public: gist.public,\n        };\n        return gists;\n      }, {});\n      gists.setGists(gistsById);\n    } catch (e) {\n      addError(`could not load gists: ${e}`);\n    }\n    this.setState({loading: false});\n  }\n  deleteSelected = async() => {\n    const {checks, gists: _gists} = this.state;\n    const ids: string[] = [];\n    // just incase?\n    checks.forEach((id, ndx) => {\n      if (_gists[id]) {\n        ids.push(id);\n      }\n    });\n    const {addError, github} = this.context;\n    this.setState({loading: true});\n    for (const id of ids) {\n      try {\n        await github.deleteGist(id);\n        gists.removeGist(id);\n      } catch(e) {\n        addError(`could not delete gist: ${id}: ${e}`);\n      }\n    }\n    this.setState({loading: false});\n  }\n  clearBackup = () => {\n    const {backupManager} = this.context;\n    backupManager.clearBackup();\n  }\n  renderLogin() {\n    const {userManager} = this.context;\n    return (\n      <div>\n        <button\n          onClick={userManager.login}\n        >Login with github</button>\n      </div>\n    );\n  }\n  renderLoad() {\n    const {userManager} = this.context;\n    const {gists, checks, loading, filter} = this.state;\n    const userData = userManager.getUserData();\n    const canLoad = !!userData && !loading;\n    const gistArray = gistsToSortedArray(gists);\n    return (\n      <div>\n        <p>\n          <button\n            className={classNames({disabled: !canLoad})}\n            onClick={this.loadGists}\n          >{gistArray.length ? 'Reload' : 'Load'} Your Gists</button>\n        </p>\n         {\n            gistArray.length >= 0 &&\n              <React.Fragment>\n              <p>\n                <EditLine className=\"foobar\" placeholder=\"search:\" value={filter} onChange={(filter:string) => {this.setState({filter})}} />\n              </p>\n              <table className=\"gists\">\n                <tbody>\n                {\n                  gistArray.filter(matchFilter(filter)).map((gist, ndx) => {\n                    return (\n                      <tr key={`g${ndx}`}>\n                        <td><input type=\"checkbox\" id={`gc${ndx}`} checked={checks.has(gist.id)} onChange={() => this.toggleCheck(gist.id)}/><label htmlFor={`gc${ndx}`}/></td>\n                        <td><a onClick={this.clearBackup} href={`${window.location.origin}?src=${encodeURIComponent(gist.id)}`}>{gist.name}</a></td>\n                        <td>{gist.date.substring(0, 10)}</td>\n                        <td>{gist.public ? '' : '🔒'}</td>\n                      </tr>\n                    );\n                  })\n                }\n                </tbody>\n              </table>\n              <div><button onClick={this.deleteSelected}>Delete Selected Gists</button></div>\n              </React.Fragment>\n          }\n      </div>\n    );\n  }\n  render() {\n    const {userManager} = this.context;\n    const userData = userManager.getUserData();\n    return userData ? this.renderLoad() : this.renderLogin();\n  }\n}\n\nLoadGist.contextType = ServiceContext;\n","import React, {useContext, useState} from 'react';\nimport Code from './Code.js';\nimport * as model from '../libs/model.js';\nimport ServiceContext from '../ServiceContext.js';\n\nexport default function LoadJSON(props) {\n  const [json, setJSON] = useState('');\n  const {addError} = useContext(ServiceContext);\n  function load() {\n    const {onLoad} = props;\n    try {\n      const data = JSON.parse(json);\n      model.setData(data);\n      onLoad();\n    } catch (e) {\n      addError(`bad json: ${e}`);\n    }\n  }\n  return (\n    <div>\n      <div style={{height: '100px'}}>\n        <Code\n          value={json}\n          onValueChange={setJSON}\n\n        />\n      </div>\n      <p>\n        <button onClick={load}>Load JSON</button>\n      </p>\n    </div>\n  )\n}","import React, {useContext, useState} from 'react';\nimport EditLine from './EditLine';\nimport * as model from '../libs/model.js';\nimport ServiceContext from '../ServiceContext.js';\n\nexport default function LoadURL(props) {\n  const [url, setUrl] = useState('');\n  const {addError} = useContext(ServiceContext);\n  async function loadUrl() {\n    const {onLoad} = props;\n    try {\n      const req = await fetch(url);\n      const data = await req.json();\n      model.setData(data);\n      onLoad()\n    } catch(e) {\n      addError(`could not load url: ${e}`);\n    }\n  } \n  return (\n    <div>\n      <EditLine value={url} onChange={setUrl} placeholder=\"url-to-json\" />\n      <p>\n        <button onClick={loadUrl}>Load URL</button>\n      </p>\n    </div>\n  )\n}","import React from 'react';\n\nexport default function Section(props) {\n  const {heading, children} = props;\n  return (\n    <div className=\"section\">\n      <div className=\"section-heading\">{heading}</div>\n      <div className=\"section-content\">\n        {children}\n      </div>\n    </div>\n  );\n}","import React from 'react';\nimport Dialog from './Dialog.js';\nimport LoadGist from './LoadGist';\nimport LoadJSON from './LoadJSON.js';\nimport LoadURL from './LoadURL.js';\nimport Section from './Section.js';\n\nexport default function Load(props) {\n  const {data, onLoad, onClose} = props;\n  return (\n    <Dialog title=\"Load\" className=\"fixed-size-dialog\" onClose={onClose}>\n      <Section heading=\"Load Gist\">\n        <LoadGist data={data} onLoad={onLoad} />\n      </Section>\n      <Section heading=\"Load URL\">\n        <LoadURL data={data} onLoad={onLoad} />\n      </Section>\n      <Section heading=\"Load JSON\">\n        <LoadJSON data={data} onLoad={onLoad} />\n      </Section>\n    </Dialog>\n  )\n}\n","import {decode, encode} from 'base64-arraybuffer';\nimport {inflate, deflate} from 'uzip-module';\n\nconst utf8Encoder = new TextEncoder();\nconst utf8Decoder = new TextDecoder();\nconst compressedPrefix = 'cb64,';\nconst uncompressedPrefix = 'b64,';\n\nexport const isCompressedBase64 = s => s.startsWith(compressedPrefix) || s.startsWith(uncompressedPrefix);\nexport function compressedBase64ToJSON(src) {\n  const isCompressed = src.startsWith(compressedPrefix);\n  const prefix = isCompressed ? compressedPrefix : uncompressedPrefix;\n  const base64 = src.substr(prefix.length)\n     .replace(/-/g, '+')\n     .replace(/_/g, '/');\n  const raw = new Uint8Array(decode(base64));\n  const bin = isCompressed \n     ? inflate(raw)\n     : raw;\n  const json = utf8Decoder.decode(bin);\n  return JSON.parse(json);\n}\n\nexport function jsonToCompressedBase64(data) {\n  const json = JSON.stringify(data);\n  const bin = utf8Encoder.encode(json);\n  const compressed = deflate(bin);\n  const useCompressed = compressed.length < bin.length;\n  const base64 = encode(useCompressed ? compressed : bin)\n      .replace(/\\+/g, '-')    // better for URLs because + and / have to be escaped\n      .replace(/\\//g, '_');\n  const prefix = useCompressed ? compressedPrefix : uncompressedPrefix;\n  return `${prefix}${base64}`;\n}\n","\nimport {isCompressedBase64, compressedBase64ToJSON} from './compression.js';\n\nconst idRE = /^[a-z0-9]+$/i;\nexport const isGistId = s => idRE.test(s);\n\nexport async function loadGistFromSrc(src, github) {\n  if (isGistId(src)) {\n    const {data, rawData} = await github.getGist(src);\n    return {data, id: src, rawData};\n  } else if (isCompressedBase64(src)) {\n    return {data: compressedBase64ToJSON(src)};\n  } else {\n    const res = await fetch(src);\n    const data = await res.json();\n    return {data};\n  }\n}\n","\nimport {clientId} from '../globals.js';\nimport {createURL} from './url.js';\nimport {createPopup} from './utils';\nimport StorageManager from './StorageManager';\nimport * as winMsgMgr from './WindowMessageManager';\n\nconst patKey = 'pat';\n\nconst getTokenURL = process.env.REACT_APP_OAUTH_HELPER_URL;\nif (!getTokenURL) {\n  throw Error ('must set environment variable: OAUTH_HELPER_URL');\n}\n\nexport default class OAuthManager {\n  private _popup?: Window;\n  private _state?: string;\n  private _storageManager: StorageManager;\n\n  constructor(storageManager: StorageManager) {\n    this._popup = undefined;\n    this._state = undefined;  // last state sent to auth\n    this._storageManager = storageManager;\n    winMsgMgr.on('auth', null, (data: any) => {\n      this._closePopup();\n      if (data.state === this._state) {\n        this.requestToken(data);\n      }\n    });\n  }\n  // TODO: rename this and decide if Github should be connected\n  pat() {\n    return this._storageManager.get(patKey);\n  }\n  subscribe(fn: () => void) {\n    this._storageManager.subscribe(patKey, fn);\n  }\n  unsubscribe(fn: () => void) {\n    this._storageManager.unsubscribe(patKey, fn);\n  }\n  _closePopup() {\n    if (this._popup) {\n      this._popup.close();\n      this._popup = undefined;\n    }\n  }\n  requestToken = async (auth: any) => {\n    try {\n      const params = {\n        client: clientId,\n        code: auth.code,\n      };\n      const url = createURL(getTokenURL, params);\n      const req = await fetch(url);\n      const data = await req.json();\n      if (!data.access_token) {\n        throw new Error(JSON.stringify(data));\n      }\n      this._storageManager.set(patKey, data.access_token);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  logout = () => {\n    this._storageManager.delete(patKey);\n  }\n  login = () => {\n    this._closePopup();\n    this._state = `${Date.now()}-${Math.random()}`;  // does this need to special? Seems like no\n    const url = createURL('https://github.com/login/oauth/authorize', {\n      client_id: clientId,\n      scope: 'gist',\n      state: this._state,\n    });\n    this._popup = createPopup(url);\n  }\n}","import React from 'react';\n\nexport default function Embed(props) {\n  const {gistId} = props;\n  const exampleId = gistId || 'f793cb359f2571409983351a6099d5d1';\n  return (\n    <div>\n      <div className=\"markdown\">\n        <p>\n        You can embed a jsGist by creating an iframe pointing to\n        {' '}<code>https://jsgist.org/embed.html?src=&lt;src&gt;</code>{' '} where\n        {' '}<code>&lt;src&gt;</code>{' '} is one of the forms above. Either\n        {' '}<code>?src=&lt;gist_id&gt;</code>{' '}or\n        {' '}<code>?src=&lt;base64url&gt;</code>{' '}or\n        {' '}<code>?src=&lt;url_to_json&gt;</code>{' '}.\n        You can also add {' '}<code>noheader=true</code>{' '} if you don't want the header\n        to appear. You can also just run them directly rather\n        than put in an iframe. <a target=\"_blank\" rel=\"noopener noreferrer\" href={`https://jsgist.org/embed.html?src=${exampleId}`}>[example]</a>{' '}\n        <a target=\"_blank\" rel=\"noopener noreferrer\" href={`https://jsgist.org/embed.html?src=${exampleId}&noheader=true`}>[example no header]</a>\n        </p>\n        { !!gistId &&\n            <React.Fragment>\n              <p>\n              For example to embed the current gist:\n              </p>\n              <pre><code style={{userSelect: 'all'}}>\n      &lt;iframe src=\"https://jsgist.org/embed.html?src={gistId}\"&gt;&lt;/iframe&gt;\n              </code></pre>\n            </React.Fragment>\n        }\n        <p>\n        </p>\n      </div>\n    </div>\n  );\n}","import React from 'react';\n\nimport {escapeTextForHTMLContent, getOrFind} from '../libs/utils';\n\n/*\n\n<!-- begin snippet: js hide: false console: true babel: false -->\n\n<!-- language: lang-js -->\n\n    console.log();\n\n<!-- language: lang-css -->\n\n    h1 { color: red; }\n\n<!-- language: lang-html -->\n\n    <h1>foo</h1>  \n\n<!-- end snippet -->\n\n*/\n\nfunction indent4(s) {\n  return s.split('\\n').map(s => `    ${s}`).join('\\n');\n}\n\nfunction makeSnippet(data, asModule) {\n  const files = data.files;\n  const mainHTML = getOrFind(files, 'index.html', 'html');\n  const mainJS = getOrFind(files, 'index.js', 'js', 'js', 'javascript');\n  const mainCSS = getOrFind(files, 'index.css', 'css');\n  return asModule\n    ? `\n<!-- begin snippet: js hide: false console: true babel: false -->\n\n<!-- language: lang-js -->\n\n<!-- language: lang-css -->\n\n${indent4(mainCSS.content)}\n\n<!-- language: lang-html -->\n\n${indent4(mainHTML.content)}\n    <script type=\"module\">\n${indent4(mainJS.content)}\n    </script>\n\n<!-- end snippet -->\n`\n    : `\n<!-- begin snippet: js hide: false console: true babel: false -->\n\n<!-- language: lang-js -->\n\n${indent4(mainJS.content)}\n\n<!-- language: lang-css -->\n\n${indent4(mainCSS.content)}\n\n<!-- language: lang-html -->\n\n${indent4(mainHTML.content)}\n\n<!-- end snippet -->\n`;\n\n}\n\nfunction openInCodepen(data) {\n  const files = data.files;\n  const mainHTML = getOrFind(files, 'index.html', 'html');\n  const mainJS = getOrFind(files, 'index.js', 'js', 'js', 'javascript');\n  const mainCSS = getOrFind(files, 'index.css', 'css');\n\n  const pen = {\n    title                 : data.name,\n    description           : data.name,\n    editors               : '101',\n    html                  : mainHTML.content,\n    css                   : mainCSS.content,\n    js                    : mainJS.content,\n  };\n\n  const elem = document.createElement('div');\n  elem.innerHTML = `\n    <form method=\"POST\" target=\"_blank\" action=\"https://codepen.io/pen/define\" class=\"hidden\">'\n      <input type=\"hidden\" name=\"data\">\n      <input type=\"submit\" />\n    \"</form>\"\n  `;\n  elem.querySelector('input[name=data]').value = JSON.stringify(pen);\n  document.body.appendChild(elem);\n  elem.querySelector('form').submit();\n  document.body.removeChild(elem);\n}\n\nfunction openInJSFiddle(data) {\n  const files = data.files;\n  const mainHTML = getOrFind(files, 'index.html', 'html');\n  const mainJS = getOrFind(files, 'index.js', 'js', 'js', 'javascript');\n  const mainCSS = getOrFind(files, 'index.css', 'css');\n\n  const elem = document.createElement('div');\n  elem.innerHTML = `\n    <form method=\"POST\" target=\"_black\" action=\"https://jsfiddle.net/api/mdn/\" class=\"hidden\">\n      <input type=\"hidden\" name=\"html\" />\n      <input type=\"hidden\" name=\"css\" />\n      <input type=\"hidden\" name=\"js\" />\n      <input type=\"hidden\" name=\"title\" />\n      <input type=\"hidden\" name=\"wrap\" value=\"b\" />\n      <input type=\"submit\" />\n    </form>\n  `;\n  elem.querySelector('input[name=html]').value = mainHTML.content;\n  elem.querySelector('input[name=css]').value = mainCSS.content;\n  elem.querySelector('input[name=js]').value = mainJS.content;\n  elem.querySelector('input[name=title]').value = data.name;\n  document.body.appendChild(elem);\n  elem.querySelector('form').submit();\n  document.body.removeChild(elem);\n}\n\nfunction makeHTML(data, asModule) {\n  const files = data.files;\n  const mainHTML = getOrFind(files, 'index.html', 'html');\n  const mainJS = getOrFind(files, 'index.js', 'js', 'js', 'javascript');\n  const mainCSS = getOrFind(files, 'index.css', 'css');\n  const isModule = asModule !== undefined ? asModule : /\\bimport\\b/.test(mainJS.content);\n  const module = isModule\n    ? ' type=\"module\"'\n    : '';\n  return `<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n    <title>${escapeTextForHTMLContent(data.name)}</title>\n    <style>\n${mainCSS.content}\n    </style>\n  </head>\n  <body>\n${mainHTML.content}\n  </body>\n  <${'script'}${module}>\n${mainJS.content}\n  </${'script'}>\n</html>\n`;\n}\n\nexport default class Export extends React.Component {\n  constructor(props) {\n    super(props);\n    const mainJS = getOrFind(props.data.files, 'index.js', 'js', 'js', 'javascript');\n    this.state = {\n      asModule: /\\bimport\\b/.test(mainJS.content),  // random guess\n    }\n  }\n  onChange = (asModule) => {\n    this.setState({asModule});\n  }\n  exportToCodepen = () => {\n    openInCodepen(this.props.data);\n  }\n  exportToJSFiddle = () => {\n    openInJSFiddle(this.props.data);\n  }\n  render() {\n    const {data} = this.props;\n    const {asModule} = this.state;\n    return (\n      <div>\n        <button onClick={this.exportToCodepen}>Codepen</button>\n        <button onClick={this.exportToJSFiddle}>JSFiddle</button>\n        <p>StackOverflow Snippet (copy the code below paste into S.O.)</p>\n        <div>\n          <div><input type=\"radio\" id=\"export-as-module\" checked={asModule} onChange={_ => this.onChange(true)}/><label htmlFor=\"export-as-module\">As es6 module</label></div>\n          <div><input type=\"radio\" id=\"export-as-script\" checked={!asModule} onChange={_ => this.onChange(false)}/><label htmlFor=\"export-as-script\">As script</label></div>\n          <p>S.O. does not support es6 modules yet so picking \"As Module\" puts the code in a &lt;script&gt; in the HTML.</p>\n        </div>\n        <pre className=\"layout-scrollbar\" style={{userSelect: 'all', overflow: 'auto', height: '5em'}}>{makeSnippet(data, asModule)}</pre>\n        <p>HTML (copy the code below paste into a file)</p>\n        <div>\n          <div><input type=\"radio\" id=\"export-as-module\" checked={asModule} onChange={_ => this.onChange(true)}/><label htmlFor=\"export-as-module\">As es6 module</label></div>\n          <div><input type=\"radio\" id=\"export-as-script\" checked={!asModule} onChange={_ => this.onChange(false)}/><label htmlFor=\"export-as-script\">As script</label></div>\n        </div>\n        <pre className=\"layout-scrollbar\" style={{userSelect: 'all', overflow: 'auto', height: '5em'}}>{makeHTML(data, asModule)}</pre>\n      </div>\n    );\n  }\n}","import React from 'react';\nimport {classNames} from '../libs/css-utils.js';\nimport * as gists from '../libs/gists.js';\nimport ServiceContext from '../ServiceContext.js';\n\nexport default class SaveAsGist extends React.Component {\n  constructor () {\n    super();\n    this.state = {\n      saving: false,\n      secret: false,\n    };\n  }\n  componentDidMount() {\n    const {userManager} = this.context;\n    userManager.subscribe(this.onPatChange);\n  }\n  componentWillUnmount() {\n    const {userManager} = this.context;\n    userManager.unsubscribe(this.onPatChange);\n  }\n  onPatChange = () => {\n    this.forceUpdate();\n  }\n  toggleSecret = () => {\n    this.setState({secret: !this.state.secret});\n  }\n  saveNew = async() => {\n    const {github, addError} = this.context;\n    const {secret} = this.state;\n    this.setState({saving: true});\n    const {data, onSave, onClose} = this.props;\n    let success = false;\n    try {\n      const {id, name, date, public: _public} = await github.createGist(data, secret);\n      gists.addGist(id, name, date, _public);\n      onSave(id);\n      success = true;\n    } catch (e) {\n      addError(`could not create gist: ${e}`)\n    }\n    this.setState({saving: false});\n    if (success) {\n      onClose();\n    }\n  }\n  saveOverExisting = async() => {\n    const {github, addError} = this.context;\n    this.setState({saving: true});\n    const {data, gistId, onClose} = this.props;\n    let success = false;\n    try {\n      const {id, name, date, public: _public} = await github.updateGist(gistId, data);\n      gists.addGist(id, name, date, _public);\n      success = true;\n    } catch (e) {\n      addError(`could not update gist: ${e}`)\n    }\n    this.setState({saving: false});\n    if (success) {\n      onClose();\n    }\n  }\n  forkAndSave = async() => {\n    const {github, addError} = this.context;\n    const {data, gistId, onSave, onClose} = this.props;\n    const {secret} = this.state;\n    this.setState({saving: true});\n    let success = false;\n    try {\n      const {id: newId} = await github.forkGist(gistId, secret);\n      const {id, name, date, public: _public} = await github.updateGist(newId, data);\n      gists.addGist(id, name, date, _public);\n      onSave(id);\n      success = true\n    } catch (e) {\n      addError(`could not fork and update gist: ${e}`);\n    }\n    this.setState({saving: false});\n    if (success) {\n      onClose();\n    }\n  }\n  renderLogin() {\n    const {userManager} = this.context;\n    return (\n      <div>\n        <button\n          onClick={userManager.login}\n        >Login with github</button>\n      </div>\n    );\n  }\n  renderSave() {\n    const {saving, secret} = this.state;\n    const {userManager} = this.context;\n    const userData = userManager.getUserData();\n    const {gistId, gistOwnerId} = this.props;\n    const canUpdate = userData && gistId && userData.id === gistOwnerId;\n    const canFork = userData && gistId && userData.id !== gistOwnerId;\n    return (\n      <div>\n        <div>\n          <button\n            className={classNames({disabled: saving})}\n            data-type=\"new\"\n            onClick={this.saveNew}\n          >Save to New Gist</button>\n          <button\n            className={classNames({disabled: !canUpdate || saving})}\n            data-type=\"update\"\n            onClick={this.saveOverExisting}\n          >Update Current Gist</button>\n          <button\n            className={classNames({disabled: !canFork || saving})}\n            data-type=\"fork\"\n            onClick={this.forkAndSave}\n          >Fork and Save Gist</button>\n        </div>\n        <div>\n          <br/>\n          <input\n            type=\"checkbox\"\n            checked={secret}\n            id=\"save-secret\"\n            onChange={this.toggleSecret}\n          />\n          <label htmlFor=\"save-secret\">Secret (unlisted)</label>\n          <blockquote>Warning:\n            <ul>\n              <li>You can not change a gist from public to secret</li>\n              <li>Secret gists are still publicly accessible they're just unlisted</li>\n            </ul>\n            (<a href=\"https://docs.github.com/en/free-pro-team@latest/github/writing-on-github/creating-gists\" target=\"_blank\" rel=\"noopener noreferrer\">see docs</a>)\n          </blockquote>\n        </div>\n      </div>\n    );\n  }\n  render() {\n    const {userManager} = this.context;\n    const userData = userManager.getUserData();\n    return userData ? this.renderSave() : this.renderLogin();\n  }\n}\n\nSaveAsGist.contextType = ServiceContext;","import React from 'react';\n\nexport default function SaveAsJSON(props) {\n  const {data} = props;\n  return (\n    <div>\n      <div>\n        Copy the text below, paste into the load ui or put somewhere on the net\n        and make your own URL with <code>{window.location.origin}?src=url-to-json</code>.\n      </div>\n      <pre className=\"layout-scrollbar\" style={{userSelect: 'all'}}>{JSON.stringify(data)}</pre>\n      <div><a target=\"_blank\" rel=\"noopener noreferrer\" href={`${window.location.origin}?src=${encodeURIComponent(`${window.location.origin}/example.json`)}`}>Example</a></div>\n    </div>\n  );\n}","import React from 'react';\n\nimport {jsonToCompressedBase64} from '../libs/compression.js';\n\nexport default function SaveAsURL(props) {\n  const {data} = props;\n  const src = jsonToCompressedBase64(data);\n  const url = `${window.location.origin}?src=${encodeURIComponent(src)}`;\n  return url.length < 8000\n    ? (\n      <div>\n        <div>Copy / bookmark the link below</div>\n        <a className=\"bookmark\" href={url} target=\"_blank\" rel=\"noopener noreferrer\">{url}</a>\n      </div>\n      )\n    : (\n      <div class=\"error-msg\">\n        Too large to save as URL\n      </div>\n      )\n    ;\n}\n","import React from 'react';\nimport Dialog from './Dialog.js';\nimport Embed from './Embed.js';\nimport Export from './Export.js';\nimport SaveAsGist from './SaveAsGist.js';\nimport SaveAsJSON from './SaveAsJSON.js';\nimport SaveAsURL from './SaveAsURL.js';\nimport Section from './Section.js';\n\nexport default function Save(props) {\n  const {data, gistId, gistOwnerId, onSave, onClose} = props;\n  return (\n    <Dialog title=\"Save\" onClose={onClose}>\n      <Section heading=\"Save As Gist\">\n        <SaveAsGist gistId={gistId} gistOwnerId={gistOwnerId} data={data} onClose={onClose} onSave={onSave} />\n      </Section>\n      <Section heading=\"Save As URL\">\n        <SaveAsURL data={data} />\n      </Section>\n      <Section heading=\"Save As JSON\">\n        <SaveAsJSON data={data} />\n      </Section>\n      <Section heading=\"Embedding\">\n        <Embed gistId={gistId} />\n      </Section>\n      <Section heading=\"Export To\">\n        <Export data={data} />\n      </Section>\n    </Dialog>\n  )\n}\n","import React from 'react';\n\nimport Dialog from './Dialog.js';\nimport Section from './Section.js';\nimport ServiceContext from '../ServiceContext.js';\n\nimport verticalIcon from '../icons/vertical-layout.svg';\nimport horizontalIcon from '../icons/horizontal-layout.svg';\nimport twoByTwoIcon from '../icons/two-by-two-layout.svg';\nimport tabbedIcon from '../icons/tabbed-layout.svg';\n\nimport {classNames} from '../libs/css-utils.js';\nimport * as uiModel from '../libs/ui-model.js';\n\nfunction RadioOption(props) {\n  const {children, onChange, selected} = props;\n  return (\n    <div className={classNames({radioSelected: selected})} onClick={onChange}>\n      {children}\n    </div>\n  );\n}\n\nfunction Radio(props) {\n  const {selectedNdx, onChange, children} = props;\n\n  let childNdx = 0;\n  const newChildren = React.Children.map(children, (child) => {\n    if (!React.isValidElement(child)) {\n      return null;\n    }\n\n    const selected = childNdx === selectedNdx;\n\n    const id = childNdx;\n    childNdx += 1;\n    return React.cloneElement(child, {\n      //...child.props,\n      selected,\n      onChange: () => onChange(id),\n    });\n  });\n\n  return (\n    <div className=\"radio\">\n      {newChildren}\n    </div>\n  );\n}\n\nclass Logout extends React.Component {\n  componentDidMount() {\n    const {userManager} = this.context;\n    userManager.subscribe(this.handleChange);\n  }\n  componentWillUnmount() {\n    const {userManager} = this.context;\n    userManager.unsubscribe(this.handleChange);\n  }\n  handleChange = () => {\n    this.forceUpdate();\n  }\n  handleLogout = () => {\n    const {userManager} = this.context;\n    userManager.logout();\n  }\n  render() {\n    const {userManager} = this.context;\n    const userData = userManager.getUserData();\n    return (!!userData &&\n      <Section heading=\"Logout\">\n        <div className=\"logout\">Logged in as:&nbsp;\n          {!!userData.login && <div className=\"username\"><a target=\"_blank\" rel=\"noopener noreferrer\" href={`https://github.com/${userData.login}`}>{userData.login}</a></div>}\n          {!!userData.avatar_url && <a className=\"user-avatar\" target=\"_blank\" rel=\"noopener noreferrer\" href={`https://github.com/${userData.login}`}><img className=\"avatar\" src={userData.avatar_url} alt=\"avatar\"/></a>}\n        </div>\n        <button onClick={this.handleLogout}>Logout</button>\n      </Section>\n    );\n  }\n}\n\nLogout.contextType = ServiceContext;\n\nexport default class Settings extends React.Component {\n  //constructor(props) {\n  //  super(props);\n  //}\n  componentDidMount() {\n    uiModel.subscribe(this.handleChange);\n  }\n  componentWillUnmount() {\n    uiModel.unsubscribe(this.handleChange);\n  }\n  handleChange = () => {\n    this.forceUpdate();\n  }\n  handleLayoutChange = (v) => {\n    uiModel.set('layout', v);\n  }\n  render() {\n    const {onClose} = this.props;\n    const {userManager} = this.context;\n    const userData = userManager.getUserData();\n    return (\n      <Dialog title=\"Settings\" onClose={onClose}>\n        { !!userData && <Logout /> }\n        <Section heading=\"Layout\">\n          <div className=\"layout\">\n            <Radio selectedNdx={uiModel.get().layout} onChange={this.handleLayoutChange}>\n              <RadioOption><img src={verticalIcon} alt=\"vertical\"/></RadioOption>\n              <RadioOption><img src={horizontalIcon} alt=\"horizontal\"/></RadioOption>\n              <RadioOption><img src={twoByTwoIcon} alt=\"2x2\" /></RadioOption>\n              <RadioOption><img src={tabbedIcon} alt=\"tabbed\" /></RadioOption>\n            </Radio>\n          </div>\n        </Section>\n      </Dialog>\n    );\n  }\n}\n\nSettings.contextType = ServiceContext;\n","import SubscriptionManager from './SubscriptionManager.ts';\n\nconst kUserManagerKey = 'foobar'; // not important\n\nexport default class UserManager {\n  constructor({\n    oauthManager,\n    github,\n    addError,\n  }) {\n    this.oauthManager = oauthManager;\n    this.github = github;\n    this.subscriptionManager = new SubscriptionManager();\n    this.addError = addError;\n    oauthManager.subscribe(this._handleNewAuth);\n    this._handleNewAuth();\n    this.userData = undefined;\n  }\n  /*\n  {\n    \"login\": \"greggman\",\n    \"id\": 234804,\n    \"node_id\": \"MDQ6VXNlcjIzNDgwNA==\",\n    \"avatar_url\": \"https://avatars2.githubusercontent.com/u/234804?v=4\",\n    \"gravatar_id\": \"\",\n    \"url\": \"https://api.github.com/users/greggman\",\n    \"html_url\": \"https://github.com/greggman\",\n    \"followers_url\": \"https://api.github.com/users/greggman/followers\",\n    \"following_url\": \"https://api.github.com/users/greggman/following{/other_user}\",\n    \"gists_url\": \"https://api.github.com/users/greggman/gists{/gist_id}\",\n    \"starred_url\": \"https://api.github.com/users/greggman/starred{/owner}{/repo}\",\n    \"subscriptions_url\": \"https://api.github.com/users/greggman/subscriptions\",\n    \"organizations_url\": \"https://api.github.com/users/greggman/orgs\",\n    \"repos_url\": \"https://api.github.com/users/greggman/repos\",\n    \"events_url\": \"https://api.github.com/users/greggman/events{/privacy}\",\n    \"received_events_url\": \"https://api.github.com/users/greggman/received_events\",\n    \"type\": \"User\",\n    \"site_admin\": false,\n    \"name\": \"Greggman\",\n    \"company\": null,\n    \"blog\": \"http://games.greggman.com\",\n    \"location\": \"Earth\",\n    \"email\": \"github@greggman.com\",\n    \"hireable\": null,\n    \"bio\": \"30 years of games\\r\\n5 years of Chrome\",\n    \"twitter_username\": null,\n    \"public_repos\": 283,\n    \"public_gists\": 80,\n    \"followers\": 1037,\n    \"following\": 3,\n    \"created_at\": \"2010-04-01T08:48:05Z\",\n    \"updated_at\": \"2020-10-24T06:05:24Z\"\n  }\n  */\n  getUserData() {\n    return this.userData;\n  }\n  _handleNewAuth = async() => {\n    this.userData = undefined;\n    const pat = this.oauthManager.pat();\n    this.github.setPat(pat);\n    if (pat) {\n      try {\n        const data = await this.github.getAuthenticatedUser();\n        this.userData = data;\n      } catch (e) {\n        this.addError(e);\n      }\n    }\n    this.subscriptionManager.notify(kUserManagerKey);\n  }\n  login = () => {\n    this.oauthManager.login();\n  }\n  logout = () => {\n    this.oauthManager.logout();\n  }\n  subscribe(fn) {\n    this.subscriptionManager.subscribe(kUserManagerKey, fn);\n  }\n  unsubscribe(fn) {\n    this.subscriptionManager.unsubscribe(kUserManagerKey, fn);\n  }\n  cleanup() {\n    this.oauthManager.unsubscribe(this._handleNewAuth);\n  }\n}\n\n","import React from 'react';\n\nimport BackupManager from './BackupManager.js';\nimport EditLine from './EditLine.js';\nimport Footer from './Footer.js';\nimport {storageManager} from '../globals.js';\nimport GitHub from '../libs/GitHub.js';\nimport Head from './Head.js';\nimport Help from './Help.js';\nimport IDE from './IDE.js';\nimport Load from './Load.js';\nimport {isGistId, loadGistFromSrc} from '../libs/loader.js';\nimport {LogManager} from './Log.js';\nimport * as model from '../libs/model.js';\nimport OAuthManager from '../libs/OAuthManager';\nimport Save from './Save.js';\nimport ServiceContext from '../ServiceContext.js';\nimport Settings from './Settings.js';\nimport UserManager from '../libs/UserManager.js';\nimport * as winMsgMgr from '../libs/WindowMessageManager';\n\nimport './App.css';\n\nconst noJSX = () => [];\nconst darkMatcher = window.matchMedia('(prefers-color-scheme: dark)');\n\nclass App extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      path: window.location.pathname,\n      dark: darkMatcher.matches,\n      loading: false,\n      dialog: noJSX,\n      gistId: '',\n      messages: [],\n      userData: {},\n      updateVersion: 0,\n    };\n    this.github = new GitHub();\n    this.logManager = new LogManager();\n    this.oauthManager = new OAuthManager(storageManager);\n    this.backupManager = new BackupManager(storageManager);\n    this.userManager = new UserManager({\n      oauthManager: this.oauthManager,\n      github: this.github,\n      addError: this.addError,\n    });\n  }\n  componentDidMount() {\n    winMsgMgr.on('newGist', null, this.handleNewGist);\n    this.github.addEventListener('userdata', (e) => {\n      this.setState({\n        userData: e.data,\n      });\n    });\n    model.add('path', window.location.pathname);\n    model.subscribe('path', (newValue) => {\n      window.history.pushState({}, '', newValue);\n      this.setState({\n        path: newValue,\n      });\n    });\n    // I still am not sure how I'm supposed to handle this.\n    // Putting my model in the state itself seems wrong\n    // and doesn't actually help since I'd have to \n    // generate an entirely new state object to change any\n    // nested property.\n    //\n    // Storing the data outside I see no way to tell\n    // components to re-render except to call forceUpdate\n    // which all the documentation says \"if you call this\n    // you're doing it wrong\".\n    //\n    // Redux is a joke. 50 lines code needed to set\n    // a single field. Repeat those 50 lines for every field.\n    // Things like redux-tools make it less to type those\n    // 50 lines but they still execute 50 to 500 lines of code\n    // just to set a single value.\n    model.subscribe(model.filesVersionKey, _ => {\n      this.forceUpdate();\n    });\n    // this is a hack because I can't figure out how to\n    // update the CodeMirror areas\n    model.subscribe('updateVersion', _ => {\n      this.setState({updateVersion: this.state.updateVersion + 1});\n    });\n\n    darkMatcher.addEventListener('change', () => {\n      this.setState({dark: darkMatcher.matches});\n    });\n\n    const query = Object.fromEntries(new URLSearchParams(window.location.search).entries());\n    if (query.newGist) {\n      window.history.pushState({}, '', `${window.location.origin}`);\n      window.opener.postMessage({type: 'gimmeDaCodez'}, '*');\n      return;\n    }\n\n    const backup = this.backupManager.getBackup();\n    let loaded = false;\n    if (backup) {\n      try {\n        const data = JSON.parse(backup);\n        if (data.href === window.location.href) {\n          model.setData(data.data);\n          const url = new URL(data.href);\n          const {src} = Object.fromEntries(new URLSearchParams(url.search).entries());\n          if (isGistId(src)) {\n            this.setState({gistId: src, gistOwnerId: data.gistOwnerId});\n          }\n          loaded = true;\n          this.addInfo('loaded backup from local storage')\n        }\n      } catch (e) {\n        console.log('bad backup')\n      }\n      this.backupManager.clearBackup();\n    }\n    if (!loaded) {\n      if (query.src) {\n        this.loadData(query.src);\n      }\n    }\n    this.updateTitle();\n  }\n  componentDidUpdate() {\n    this.updateTitle();\n  }\n  updateTitle() {\n    const data = model.getData();\n    document.title = data.name || 'jsGist';\n  }\n  async loadData(src) {\n    this.setState({loading: true});\n    let success = true;\n    try {\n      const {data, id, rawData} = await loadGistFromSrc(src, this.github);\n      model.setData(data);\n      if (id) {\n        this.setState({\n          gistId: src,\n          gistOwnerId: rawData?.owner?.id,\n        });\n      }\n    } catch (e) {\n      success = false;\n      console.warn(e);\n      this.addError(`could not load jsGist: src=${src} ${e}`);\n    }\n    this.setState({loading: false});\n    if (success) {\n      this.handleRun();\n    }\n  }\n  handleNewGist = (data) => {\n    let success = true;\n    try {\n      model.setData(data);\n      this.backupManager.clearBackup();\n    } catch (e) {\n      success = false;\n      console.warn(e);\n      this.addError(`could create new jsGist: ${e}`);\n    }\n    if (success) {\n      this.handleRun();\n    }\n  };\n  addMsg = (msg, className) => {\n    switch (className) {\n      case 'error':\n        console.error(msg);\n        break;\n      default:\n        console.log(msg);\n        break;\n    }\n    this.setState({messages: [{msg: msg.toString(), className}, ...this.state.messages]});\n    setTimeout(() => {\n      this.setState({messages: this.state.messages.slice(0, this.state.messages.length - 1)});\n    }, 5000);\n  }\n  addInfo = (msg) => this.addMsg(msg, 'info');\n  addError = (msg) => this.addMsg(msg, 'error');\n  closeDialog = () => {\n    this.setState({dialog: noJSX});\n  }\n  registerRunnerAPI = (api) => {\n    this.runnerAPI = api;\n    this.handleStop();\n  }\n  handleNew = async() => {\n    this.backupManager.clearBackup();\n    window.location.href = window.location.origin;\n    //window.history.pushState({}, '', `${window.location.origin}`);\n    //model.setData(model.getNewData());\n  }\n  handleRun = async () => {\n    this.backupManager.setBackup(JSON.stringify({\n      href: window.location.href,\n      data: model.getData(),\n      gistOwnerId: this.state.gistOwnerId,\n    }));\n    this.logManager.clear();\n    console.clear();\n    this.runnerAPI.run(model.getData());\n  }\n  handleStop = async () => {\n    this.runnerAPI.run(model.getBlankData(), true);\n  }\n  handleSave = async () => {\n    this.setState({dialog: this.renderSave});\n  }\n  handleSettings = () => {\n    this.setState({dialog: this.renderSettings});\n  }\n  handleHelp = () => {\n    this.setState({dialog: this.renderHelp});\n  }\n  handleLoad = () => {\n    this.setState({dialog: this.renderLoad});\n  }\n  handleOnLoad = async() => {\n    this.setState({dialog: noJSX});\n    this.handleRun();\n  }\n  handleOnSave = (gistId) => {\n    window.history.pushState({}, '', `${window.location.origin}?src=${gistId}`);\n    this.setState({\n      gistId,\n      gistOwnerId: this.userManager.getUserData().id,\n    });\n  }\n  handleAbort = () => {\n    this.abort();\n  };\n  renderHelp = () => {\n    return (<Help onClose={this.closeDialog} />);\n  }\n  renderSettings = () => {\n    return (\n      <Settings onClose={this.closeDialog} />\n    );\n  }\n  renderLoad = () => {\n    return (\n      <Load\n        onLoad={this.handleOnLoad}\n        onClose={this.closeDialog}\n      />\n    );\n  }\n  renderSave = () => {\n    const data = model.getData();\n    return (\n      <Save\n        onSave={this.handleOnSave}\n        onClose={this.closeDialog}\n        gistId={this.state.gistId}\n        gistOwnerId={this.state.gistOwnerId}\n        data={data} />\n    );\n  }\n  render() {\n    const data = model.getData();\n    const {\n      loading,\n      dialog,\n      updateVersion: hackKey,\n      userData,\n      gistId,\n    } = this.state;\n    return (\n      <div className=\"App\">\n        <ServiceContext.Provider value={{\n          github: this.github,\n          addError: this.addError,\n          addInfo: this.addInfo,\n          storageManager,\n          logManager: this.logManager,\n          userManager: this.userManager,\n          backupManager: this.backupManager,\n        }}>\n        <div className=\"content\">\n          <Head />\n          <div className=\"top\">\n            <div className=\"left\">\n              <div className=\"name\">\n                <EditLine value={data.name} onChange={v => model.setName(v)} />\n                {!!userData.name && <div className=\"username\"><a target=\"_blank\" rel=\"noopener noreferrer\" href={`https://github.com/${userData.name}`}>{userData.name}</a></div>}\n                {!!userData.avatarURL && <a target=\"_blank\" rel=\"noopener noreferrer\" href={`https://github.com/${userData.name}`}><img className=\"avatar\" src={userData.avatarURL} alt=\"avatar\"/></a>}\n              </div>\n            </div>\n            <div className=\"right\">\n              <button tabIndex=\"1\" onClick={this.handleRun}>Run</button>\n              <button tabIndex=\"1\" onClick={this.handleStop}>Stop</button>\n              <button tabIndex=\"1\" onClick={this.handleSave}>Save</button>\n              <button tabIndex=\"1\" onClick={this.handleNew}>New</button>\n              <button tabIndex=\"1\" onClick={this.handleLoad}>Load</button>\n              <button tabIndex=\"1\" onClick={this.handleSettings} title=\"settings\"><img src={`${window.location.origin}/resources/images/gear.svg`} alt=\"settings\"></img></button>\n              <button tabIndex=\"1\" onClick={this.handleHelp} title=\"help\">?</button>\n            </div>\n          </div>\n          {\n            !loading &&\n              <div className=\"bottom\">\n                <IDE\n                  hackKey={hackKey}\n                  data={data}\n                  registerRunnerAPI={this.registerRunnerAPI}\n                />\n              </div>\n          }\n        </div>\n        <Footer\n          gistId={gistId}\n          title={data.name}\n        />\n        {dialog()}\n        <div className=\"messages\">\n          {\n            this.state.messages.map(({msg, className}, i) => (<div className={className} key={`err${i}`}>{msg}</div>))\n          }\n        </div>\n        </ServiceContext.Provider>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport './scrollbars.js';\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = __webpack_public_path__ + \"static/media/vertical-layout.f248a432.svg\";","module.exports = __webpack_public_path__ + \"static/media/horizontal-layout.e3f3298b.svg\";","module.exports = __webpack_public_path__ + \"static/media/two-by-two-layout.23605ce8.svg\";","module.exports = __webpack_public_path__ + \"static/media/tabbed-layout.8a8b9bc8.svg\";"],"sourceRoot":""}